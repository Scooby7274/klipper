===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Args: ['/home/Klipper/klipper/klippy/klippy.py', '/home/Klipper/printer_data/config/printer.cfg', '-l', '/home/Klipper/printer_data/logs/klippy.log', '-I', '/home/Klipper/printer_data/comms/klippy.serial', '-a', '/home/Klipper/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-275-g8ef0f7d7-dirty'
Untracked files: klippy/extras/gcode_shell_command.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper.git
CPU: 4 core ARMv7 Processor rev 4 (v7l)
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
webhooks client 1965508256: {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
=============== Log rollover at Wed Sep 20 17:05:51 2023 ===============
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup/klipper’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Stats 163650.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000051 bytes_write=537759 bytes_read=8657865 bytes_retransmit=0 bytes_invalid=0 send_seq=83264 receive_seq=83264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003474  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.57 cputime=3347.038 memavail=680960 print_time=72732.665 buffer_time=0.397 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1965508256: Disconnected
Restarting printer
Start printer at Wed Sep 20 17:08:34 2023 (1695244114.8 163651.7)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup-main/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946568688: New connection
webhooks client 1946568688: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 163657.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2887 bytes_read=5457 bytes_retransmit=9 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1891 upcoming_bytes=90 freq=72009211  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.60 cputime=3350.975 memavail=679796 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946568688
webhooks: registering remote method 'reboot_machine' for connection id: 1946568688
webhooks: registering remote method 'pause_job_queue' for connection id: 1946568688
webhooks: registering remote method 'start_job_queue' for connection id: 1946568688
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946568688
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946568688
webhooks: registering remote method 'timelapse_render' for connection id: 1946568688
Stats 163658.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5082 bytes_read=5733 bytes_retransmit=9 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72006639  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.60 cputime=3351.085 memavail=679564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163659.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5119 bytes_read=5849 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003960  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.55 cputime=3351.148 memavail=684140 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163660.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5125 bytes_read=5970 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004029  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.55 cputime=3351.192 memavail=684140 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163661.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5131 bytes_read=6091 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004632  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.55 cputime=3351.234 memavail=683468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup-main/script.sh: No such file or directory

Command {update_git_script} finished

Stats 163662.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000249 mcu_task_stddev=0.000447 bytes_write=5137 bytes_read=6214 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004177  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.55 cputime=3351.336 memavail=682516 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163663.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000249 mcu_task_stddev=0.000447 bytes_write=5143 bytes_read=6335 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004233  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.55 cputime=3351.382 memavail=682564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163664.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000249 mcu_task_stddev=0.000447 bytes_write=5149 bytes_read=6456 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003991  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.51 cputime=3351.427 memavail=681444 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163665.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000249 mcu_task_stddev=0.000447 bytes_write=5155 bytes_read=6562 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003800  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.51 cputime=3351.473 memavail=680996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163666.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000249 mcu_task_stddev=0.000447 bytes_write=5161 bytes_read=6683 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003719  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.51 cputime=3351.513 memavail=678604 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163667.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5167 bytes_read=6817 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003611  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.51 cputime=3351.552 memavail=678220 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163668.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5173 bytes_read=6923 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003586  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.51 cputime=3351.592 memavail=678572 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163669.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5179 bytes_read=7044 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.47 cputime=3351.631 memavail=678220 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163670.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5185 bytes_read=7165 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.47 cputime=3351.670 memavail=678316 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163671.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5191 bytes_read=7271 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.47 cputime=3351.710 memavail=678668 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163672.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5197 bytes_read=7405 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003623  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.47 cputime=3351.751 memavail=678476 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163673.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5203 bytes_read=7526 bytes_retransmit=9 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.47 cputime=3351.791 memavail=678476 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163674.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5209 bytes_read=7632 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.43 cputime=3351.829 memavail=678476 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163675.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5221 bytes_read=7769 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.43 cputime=3351.871 memavail=678476 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163676.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5227 bytes_read=7890 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.43 cputime=3351.918 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163677.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5233 bytes_read=8009 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.43 cputime=3351.962 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163678.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5239 bytes_read=8130 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.43 cputime=3352.005 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163679.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5245 bytes_read=8251 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.40 cputime=3352.047 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163680.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5251 bytes_read=8357 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.40 cputime=3352.089 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163681.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5257 bytes_read=8478 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.40 cputime=3352.131 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163682.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5263 bytes_read=8599 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.40 cputime=3352.174 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163683.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5269 bytes_read=8718 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.40 cputime=3352.216 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163684.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5275 bytes_read=8839 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.36 cputime=3352.257 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163685.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5281 bytes_read=8960 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.36 cputime=3352.300 memavail=678256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163686.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5287 bytes_read=9066 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.36 cputime=3352.342 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163687.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5293 bytes_read=9200 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.36 cputime=3352.386 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163688.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5299 bytes_read=9321 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.36 cputime=3352.428 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163689.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5305 bytes_read=9427 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.33 cputime=3352.469 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163690.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5311 bytes_read=9548 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.33 cputime=3352.511 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163691.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5317 bytes_read=9669 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.33 cputime=3352.554 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163692.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5323 bytes_read=9788 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.33 cputime=3352.597 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163693.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5329 bytes_read=9909 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.33 cputime=3352.639 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163694.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5335 bytes_read=10030 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.31 cputime=3352.681 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163695.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5341 bytes_read=10136 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.31 cputime=3352.725 memavail=682268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163696.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5347 bytes_read=10257 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.31 cputime=3352.771 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163697.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5353 bytes_read=10378 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.31 cputime=3352.816 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163698.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5359 bytes_read=10497 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.31 cputime=3352.858 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163699.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5365 bytes_read=10618 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.28 cputime=3352.901 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163700.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5371 bytes_read=10739 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003485  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.28 cputime=3352.946 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163701.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5377 bytes_read=10845 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.28 cputime=3352.990 memavail=680760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163702.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5383 bytes_read=10966 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.28 cputime=3353.034 memavail=680016 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163703.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5389 bytes_read=11100 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.28 cputime=3353.060 memavail=678764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163704.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5395 bytes_read=11206 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.26 cputime=3353.095 memavail=678768 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163705.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5401 bytes_read=11327 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.26 cputime=3353.139 memavail=678768 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163706.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5407 bytes_read=11448 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003478  heater_bed: target=0 temp=28.8 pwm=0.000 sysload=0.26 cputime=3353.181 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163707.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5413 bytes_read=11554 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003475  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.26 cputime=3353.226 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163708.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5419 bytes_read=11703 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003475  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.26 cputime=3353.271 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.3 pwm=0.000
Stats 163709.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5425 bytes_read=11809 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.24 cputime=3353.316 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163710.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5431 bytes_read=11915 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.24 cputime=3353.358 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163711.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5437 bytes_read=12044 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.24 cputime=3353.399 memavail=677764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Stats 163818.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=6124 bytes_read=24730 bytes_retransmit=9 bytes_invalid=0 send_seq=411 receive_seq=411 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003465  heater_bed: target=0 temp=28.7 pwm=0.000 sysload=0.35 cputime=3357.783 memavail=679488 print_time=166.651 buffer_time=0.129 print_stall=0 extruder: target=0 temp=30.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946568688: Disconnected
Restarting printer
Start printer at Wed Sep 20 17:11:22 2023 (1695244282.6 163819.5)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946568616: New connection
webhooks client 1946568616: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 163824.8: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000032 bytes_write=2890 bytes_read=5482 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1573 upcoming_bytes=408 freq=72004310  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.76 cputime=3361.647 memavail=679396 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946568616
webhooks: registering remote method 'reboot_machine' for connection id: 1946568616
webhooks: registering remote method 'pause_job_queue' for connection id: 1946568616
webhooks: registering remote method 'start_job_queue' for connection id: 1946568616
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946568616
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946568616
webhooks: registering remote method 'timelapse_render' for connection id: 1946568616
Stats 163825.8: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000032 bytes_write=5106 bytes_read=5828 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=245 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003758  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.76 cputime=3361.749 memavail=677936 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163826.8: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000032 bytes_write=5112 bytes_read=5934 bytes_retransmit=0 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003600  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.76 cputime=3361.810 memavail=677936 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163827.8: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000032 bytes_write=5118 bytes_read=6055 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72005293  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.76 cputime=3361.868 memavail=677688 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163828.8: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000032 bytes_write=5124 bytes_read=6176 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004385  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.86 cputime=3361.911 memavail=677688 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163829.8: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000461 bytes_write=5130 bytes_read=6299 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004108  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.86 cputime=3361.954 memavail=677688 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163830.8: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000461 bytes_write=5136 bytes_read=6420 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003901  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.86 cputime=3361.998 memavail=677688 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163831.8: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000461 bytes_write=5142 bytes_read=6541 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003944  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.86 cputime=3362.038 memavail=677464 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163832.8: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000461 bytes_write=5148 bytes_read=6647 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003793  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.86 cputime=3362.079 memavail=677464 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup/klipper’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 163833.8: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000461 bytes_write=5154 bytes_read=6768 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003713  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.79 cputime=3362.136 memavail=676496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163834.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5160 bytes_read=6902 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003675  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.79 cputime=3362.184 memavail=676272 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163835.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5166 bytes_read=7008 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003611  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.79 cputime=3362.235 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163836.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5172 bytes_read=7129 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003571  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.79 cputime=3362.281 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163837.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5178 bytes_read=7250 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.79 cputime=3362.326 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163838.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5184 bytes_read=7356 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.73 cputime=3362.371 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163839.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5190 bytes_read=7490 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.73 cputime=3362.417 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163840.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5196 bytes_read=7611 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003614  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.73 cputime=3362.465 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163841.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5202 bytes_read=7717 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=28.6 pwm=0.000 sysload=0.73 cputime=3362.518 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163842.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5214 bytes_read=7854 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.73 cputime=3362.573 memavail=675088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Stats 163843.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5220 bytes_read=7975 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.83 cputime=3362.632 memavail=670088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Everything up-to-date

Command {update_git_script} finished

Stats 163844.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5226 bytes_read=8094 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003513  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.83 cputime=3362.704 memavail=678936 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163845.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5232 bytes_read=8215 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.83 cputime=3362.740 memavail=677364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163846.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5238 bytes_read=8336 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.83 cputime=3362.779 memavail=677356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163847.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5244 bytes_read=8442 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.83 cputime=3362.823 memavail=676460 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163848.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5250 bytes_read=8563 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.76 cputime=3362.867 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163849.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5256 bytes_read=8697 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.76 cputime=3362.908 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163850.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5262 bytes_read=8803 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.76 cputime=3362.945 memavail=676076 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163851.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5268 bytes_read=8924 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.76 cputime=3362.983 memavail=675948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163852.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5274 bytes_read=9045 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.76 cputime=3363.021 memavail=675788 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163853.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5280 bytes_read=9151 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.70 cputime=3363.064 memavail=675788 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163854.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5305 bytes_read=9295 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.70 cputime=3363.108 memavail=675564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163855.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5330 bytes_read=9426 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.70 cputime=3363.155 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163856.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5336 bytes_read=9532 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.70 cputime=3363.200 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163857.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5342 bytes_read=9668 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.70 cputime=3363.245 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163858.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5348 bytes_read=9774 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.65 cputime=3363.285 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163859.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5354 bytes_read=9893 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.65 cputime=3363.324 memavail=675096 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163860.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5360 bytes_read=10029 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.65 cputime=3363.363 memavail=674968 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163861.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5366 bytes_read=10135 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.65 cputime=3363.402 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163862.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5372 bytes_read=10241 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003510  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.65 cputime=3363.440 memavail=674936 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163863.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5378 bytes_read=10377 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.59 cputime=3363.480 memavail=675064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163864.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000012 bytes_write=5384 bytes_read=10483 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.59 cputime=3363.518 memavail=675160 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163865.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5390 bytes_read=10602 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.59 cputime=3363.558 memavail=678520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163866.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5396 bytes_read=10738 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.59 cputime=3363.601 memavail=677624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163867.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5402 bytes_read=10844 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.59 cputime=3363.640 memavail=676952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163868.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5408 bytes_read=10950 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.55 cputime=3363.679 memavail=676056 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163869.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5414 bytes_read=11086 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.55 cputime=3363.718 memavail=675384 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163870.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5420 bytes_read=11205 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.55 cputime=3363.758 memavail=675000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163871.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5426 bytes_read=11311 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.55 cputime=3363.797 memavail=675000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163872.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5432 bytes_read=11447 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.55 cputime=3363.839 memavail=675000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163873.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5438 bytes_read=11553 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.50 cputime=3363.879 memavail=675000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163874.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5444 bytes_read=11659 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.50 cputime=3363.921 memavail=675004 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.1 pwm=0.000
Stats 163875.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5450 bytes_read=11808 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.4 pwm=0.000 sysload=0.50 cputime=3363.964 memavail=678564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163876.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5456 bytes_read=11914 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.50 cputime=3364.005 memavail=678548 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163877.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5462 bytes_read=12020 bytes_retransmit=0 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.50 cputime=3364.045 memavail=678548 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Stats 163878.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5468 bytes_read=12150 bytes_retransmit=0 bytes_invalid=0 send_seq=303 receive_seq=303 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=28.5 pwm=0.000 sysload=0.46 cputime=3364.088 memavail=678548 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=30.0 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot stat '/home/pi/printer_data/': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Cannot rewrite branches: You have unstaged changes.

[main cb613de] New backup from 20-09-23
 5 files changed, 7 insertions(+), 35 deletions(-)
 delete mode 100644 .github/workflows/close_bot.yml
 rewrite README.md (99%)
 mode change 100644 => 100755 install.sh

To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 ! [rejected]        main -> main (fetch first)

error: failed to push some refs to 'https://github.com/Scooby7274/Sovol_KlipperPI3.git'

hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.

Command {update_git_script} finished

Unknown command:"GIT"
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot stat '/home/pi/printer_data/': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/41) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is ahead of 'origin/main' by 1 commit.
  (use "git push" to publish your local commits)

nothing to commit, working tree clean

To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 ! [rejected]        main -> main (fetch first)

error: failed to push some refs to 'https://github.com/Scooby7274/Sovol_KlipperPI3.git'

hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot stat '/home/pi/printer_data/': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/41) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is ahead of 'origin/main' by 1 commit.
  (use "git push" to publish your local commits)

nothing to commit, working tree clean

To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 ! [rejected]        main -> main (fetch first)

error: failed to push some refs to 'https://github.com/Scooby7274/Sovol_KlipperPI3.git'

hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.

Command {update_git_script} finished

Stats 166855.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=25277 bytes_read=365222 bytes_retransmit=0 bytes_invalid=0 send_seq=3485 receive_seq=3485 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003457  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.02 cputime=3486.976 memavail=671224 print_time=3036.432 buffer_time=0.106 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946568616: Disconnected
Restarting printer
Start printer at Wed Sep 20 18:02:00 2023 (1695247320.1 166857.0)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946576280: New connection
webhooks client 1946576280: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 166862.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2998 bytes_read=5472 bytes_retransmit=9 bytes_invalid=0 send_seq=205 receive_seq=202 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1865 upcoming_bytes=20 freq=72005755  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.10 cputime=3490.894 memavail=670844 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946576280
webhooks: registering remote method 'reboot_machine' for connection id: 1946576280
webhooks: registering remote method 'pause_job_queue' for connection id: 1946576280
webhooks: registering remote method 'start_job_queue' for connection id: 1946576280
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946576280
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946576280
webhooks: registering remote method 'timelapse_render' for connection id: 1946576280
Stats 166863.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5097 bytes_read=5738 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=245 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=18 upcoming_bytes=0 freq=72006419  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.10 cputime=3490.988 memavail=672288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166864.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5135 bytes_read=5854 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=7 upcoming_bytes=0 freq=72006163  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.10 cputime=3491.048 memavail=672064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.6 pwm=0.000
Stats 166865.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5153 bytes_read=5985 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004601  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.25 cputime=3491.090 memavail=672064 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data/'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 166866.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5180 bytes_read=6116 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004075  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.25 cputime=3491.149 memavail=671340 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166867.3: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000444 bytes_write=5186 bytes_read=6239 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003748  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.25 cputime=3491.190 memavail=671120 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166868.3: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000444 bytes_write=5192 bytes_read=6360 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003640  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.25 cputime=3491.238 memavail=670672 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166869.3: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000444 bytes_write=5219 bytes_read=6491 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003653  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.25 cputime=3491.285 memavail=670704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 166870.3: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000444 bytes_write=5267 bytes_read=6617 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003613  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.23 cputime=3491.332 memavail=674892 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166871.3: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000444 bytes_write=5294 bytes_read=6748 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.23 cputime=3491.383 memavail=674220 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166872.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5342 bytes_read=6904 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003568  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.23 cputime=3491.437 memavail=673100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166873.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5369 bytes_read=7020 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.23 cputime=3491.487 memavail=672876 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166874.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5396 bytes_read=7151 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003555  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.23 cputime=3491.535 memavail=672652 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166875.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5402 bytes_read=7272 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.29 cputime=3491.589 memavail=671756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.6 pwm=0.000
Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/41) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

Stats 166876.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5429 bytes_read=7388 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.29 cputime=3491.647 memavail=673832 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
On branch main
Your branch is ahead of 'origin/main' by 1 commit.
  (use "git push" to publish your local commits)

nothing to commit, working tree clean

To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 ! [rejected]        main -> main (fetch first)

error: failed to push some refs to 'https://github.com/Scooby7274/Sovol_KlipperPI3.git'

hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.

Command {update_git_script} finished

Stats 166877.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5456 bytes_read=7534 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.29 cputime=3491.694 memavail=676052 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166878.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5462 bytes_read=7655 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003513  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.29 cputime=3491.735 memavail=675604 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166879.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5468 bytes_read=7761 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.29 cputime=3491.775 memavail=674932 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166880.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5501 bytes_read=7908 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.35 cputime=3491.817 memavail=672788 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166881.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5528 bytes_read=8039 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.35 cputime=3491.858 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166882.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5576 bytes_read=8180 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.35 cputime=3491.898 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166883.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5582 bytes_read=8301 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.35 cputime=3491.937 memavail=671888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166884.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5588 bytes_read=8422 bytes_retransmit=9 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.35 cputime=3491.975 memavail=670992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.6 pwm=0.000
Stats 166885.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5615 bytes_read=8538 bytes_retransmit=9 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.32 cputime=3492.014 memavail=670896 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166886.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5642 bytes_read=8669 bytes_retransmit=9 bytes_invalid=0 send_seq=307 receive_seq=307 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.32 cputime=3492.055 memavail=670992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166887.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5648 bytes_read=8790 bytes_retransmit=9 bytes_invalid=0 send_seq=308 receive_seq=308 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003528  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.32 cputime=3492.099 memavail=671024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166888.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5654 bytes_read=8909 bytes_retransmit=9 bytes_invalid=0 send_seq=309 receive_seq=309 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.32 cputime=3492.140 memavail=671024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166889.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5660 bytes_read=9030 bytes_retransmit=9 bytes_invalid=0 send_seq=310 receive_seq=310 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.32 cputime=3492.180 memavail=670864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Unknown command:"GIT"
Stats 166890.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5666 bytes_read=9151 bytes_retransmit=9 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.29 cputime=3492.218 memavail=669696 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166891.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5693 bytes_read=9267 bytes_retransmit=9 bytes_invalid=0 send_seq=314 receive_seq=314 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.29 cputime=3492.256 memavail=669704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166892.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5720 bytes_read=9411 bytes_retransmit=9 bytes_invalid=0 send_seq=317 receive_seq=317 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.29 cputime=3492.303 memavail=674240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166893.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5747 bytes_read=9542 bytes_retransmit=9 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.29 cputime=3492.343 memavail=673344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.6 pwm=0.000
Stats 166894.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5753 bytes_read=9648 bytes_retransmit=9 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.29 cputime=3492.386 memavail=672420 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166895.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5780 bytes_read=9779 bytes_retransmit=9 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.51 cputime=3492.431 memavail=671300 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166896.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=5807 bytes_read=9910 bytes_retransmit=9 bytes_invalid=0 send_seq=327 receive_seq=327 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.51 cputime=3492.477 memavail=670404 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166897.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5834 bytes_read=10041 bytes_retransmit=9 bytes_invalid=0 send_seq=330 receive_seq=330 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.51 cputime=3492.524 memavail=669512 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166898.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5861 bytes_read=10172 bytes_retransmit=9 bytes_invalid=0 send_seq=333 receive_seq=333 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.51 cputime=3492.568 memavail=669512 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166899.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5867 bytes_read=10293 bytes_retransmit=9 bytes_invalid=0 send_seq=334 receive_seq=334 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.51 cputime=3492.609 memavail=669512 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166900.3: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5915 bytes_read=10419 bytes_retransmit=9 bytes_invalid=0 send_seq=339 receive_seq=339 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3492.655 memavail=669016 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166901.4: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5921 bytes_read=10540 bytes_retransmit=9 bytes_invalid=0 send_seq=340 receive_seq=340 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3492.695 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166902.4: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000017 mcu_task_stddev=0.000029 bytes_write=5927 bytes_read=10661 bytes_retransmit=9 bytes_invalid=0 send_seq=341 receive_seq=341 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003479  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3492.732 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166903.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000026 bytes_write=5933 bytes_read=10782 bytes_retransmit=9 bytes_invalid=0 send_seq=342 receive_seq=342 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003478  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3492.773 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166904.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000026 bytes_write=5960 bytes_read=10913 bytes_retransmit=9 bytes_invalid=0 send_seq=345 receive_seq=345 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003476  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3492.816 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166905.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000026 bytes_write=5966 bytes_read=11034 bytes_retransmit=9 bytes_invalid=0 send_seq=346 receive_seq=346 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.51 cputime=3492.859 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166906.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000026 bytes_write=5993 bytes_read=11150 bytes_retransmit=9 bytes_invalid=0 send_seq=349 receive_seq=349 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.51 cputime=3492.903 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.6 pwm=0.000
Stats 166907.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000026 bytes_write=5999 bytes_read=11271 bytes_retransmit=9 bytes_invalid=0 send_seq=350 receive_seq=350 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.51 cputime=3492.948 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166908.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6005 bytes_read=11405 bytes_retransmit=9 bytes_invalid=0 send_seq=351 receive_seq=351 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=28.1 pwm=0.000 sysload=0.51 cputime=3492.989 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 166909.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6011 bytes_read=11511 bytes_retransmit=9 bytes_invalid=0 send_seq=352 receive_seq=352 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.51 cputime=3493.029 memavail=666496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166910.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6017 bytes_read=11632 bytes_retransmit=9 bytes_invalid=0 send_seq=353 receive_seq=353 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3493.070 memavail=664980 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166911.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6044 bytes_read=11763 bytes_retransmit=9 bytes_invalid=0 send_seq=356 receive_seq=356 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.47 cputime=3493.114 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166912.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6071 bytes_read=11879 bytes_retransmit=9 bytes_invalid=0 send_seq=359 receive_seq=359 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.47 cputime=3493.160 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166913.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6077 bytes_read=12013 bytes_retransmit=9 bytes_invalid=0 send_seq=360 receive_seq=360 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.47 cputime=3493.205 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166914.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6083 bytes_read=12134 bytes_retransmit=9 bytes_invalid=0 send_seq=361 receive_seq=361 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.47 cputime=3493.247 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166915.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6110 bytes_read=12250 bytes_retransmit=9 bytes_invalid=0 send_seq=364 receive_seq=364 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=28.0 pwm=0.000 sysload=0.43 cputime=3493.289 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.5 pwm=0.000
Stats 166916.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000022 bytes_write=6137 bytes_read=12375 bytes_retransmit=9 bytes_invalid=0 send_seq=367 receive_seq=367 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.43 cputime=3493.332 memavail=664992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 167933.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=13778 bytes_read=133382 bytes_retransmit=9 bytes_invalid=0 send_seq=1536 receive_seq=1535 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=19 upcoming_bytes=0 freq=72003474  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.04 cputime=3535.559 memavail=673184 print_time=1076.684 buffer_time=0.514 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946576280: Disconnected
Restarting printer
Start printer at Wed Sep 20 18:19:57 2023 (1695248397.9 167934.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946668096: New connection
webhooks client 1946668096: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 167940.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2996 bytes_read=5492 bytes_retransmit=0 bytes_invalid=0 send_seq=204 receive_seq=201 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=1885 upcoming_bytes=0 freq=72008690  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.12 cputime=3539.434 memavail=673228 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946668096
webhooks: registering remote method 'reboot_machine' for connection id: 1946668096
webhooks: registering remote method 'pause_job_queue' for connection id: 1946668096
webhooks: registering remote method 'start_job_queue' for connection id: 1946668096
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946668096
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946668096
webhooks: registering remote method 'timelapse_render' for connection id: 1946668096
Stats 167941.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5099 bytes_read=5828 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=245 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004261  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.12 cputime=3539.530 memavail=672760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167942.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5105 bytes_read=5934 bytes_retransmit=0 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003384  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.11 cputime=3539.591 memavail=671760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167943.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5111 bytes_read=6055 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003377  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.11 cputime=3539.649 memavail=671760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167944.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5117 bytes_read=6176 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003438  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.11 cputime=3539.691 memavail=671088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167945.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5123 bytes_read=6299 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003439  heater_bed: target=0 temp=27.9 pwm=0.000 sysload=0.11 cputime=3539.731 memavail=670192 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167946.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5129 bytes_read=6420 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003440  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.11 cputime=3539.771 memavail=669520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167947.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5135 bytes_read=6541 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003453  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.10 cputime=3539.810 memavail=668624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167948.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5141 bytes_read=6647 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003416  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.10 cputime=3539.852 memavail=668624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167949.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5147 bytes_read=6768 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003434  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.10 cputime=3539.892 memavail=671368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167950.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5153 bytes_read=6902 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003435  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.10 cputime=3539.920 memavail=671124 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167951.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5159 bytes_read=7008 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003409  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.10 cputime=3539.957 memavail=671124 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167952.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5165 bytes_read=7129 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003417  heater_bed: target=0 temp=27.6 pwm=0.000 sysload=0.09 cputime=3539.999 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167953.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5171 bytes_read=7250 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003431  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.09 cputime=3540.043 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167954.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5177 bytes_read=7356 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.09 cputime=3540.086 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167955.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5183 bytes_read=7490 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003456  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.09 cputime=3540.128 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167956.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5189 bytes_read=7611 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.09 cputime=3540.171 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167957.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5195 bytes_read=7717 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.08 cputime=3540.214 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167958.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5207 bytes_read=7854 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.08 cputime=3540.259 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167959.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5213 bytes_read=7975 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.08 cputime=3540.299 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167960.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5219 bytes_read=8094 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.08 cputime=3540.341 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167961.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5225 bytes_read=8215 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.08 cputime=3540.382 memavail=669884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167962.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5231 bytes_read=8336 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.08 cputime=3540.422 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167963.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5237 bytes_read=8442 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.08 cputime=3540.461 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167964.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5243 bytes_read=8563 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.08 cputime=3540.502 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167965.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5249 bytes_read=8697 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.6 pwm=0.000 sysload=0.08 cputime=3540.545 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167966.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5255 bytes_read=8803 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.08 cputime=3540.587 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167967.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5261 bytes_read=8924 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.07 cputime=3540.627 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167968.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5267 bytes_read=9045 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.07 cputime=3540.668 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167969.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5273 bytes_read=9151 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.07 cputime=3540.710 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167970.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5279 bytes_read=9285 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.07 cputime=3540.752 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167971.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5285 bytes_read=9406 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.07 cputime=3540.793 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167972.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5291 bytes_read=9512 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=27.6 pwm=0.000 sysload=0.06 cputime=3540.833 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167973.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5297 bytes_read=9633 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.06 cputime=3540.876 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167974.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5303 bytes_read=9754 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.06 cputime=3540.919 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167975.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5309 bytes_read=9873 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.06 cputime=3540.960 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167976.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5315 bytes_read=9994 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.06 cputime=3541.001 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167977.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5321 bytes_read=10115 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.06 cputime=3541.043 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167978.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5327 bytes_read=10221 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.06 cputime=3541.084 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167979.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5333 bytes_read=10342 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.06 cputime=3541.126 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167980.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5339 bytes_read=10463 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=27.6 pwm=0.000 sysload=0.06 cputime=3541.166 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167981.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5345 bytes_read=10582 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.06 cputime=3541.206 memavail=667888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167982.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5351 bytes_read=10703 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.248 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167983.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5357 bytes_read=10824 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.294 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167984.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5363 bytes_read=10930 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.05 cputime=3541.335 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167985.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5369 bytes_read=11066 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.05 cputime=3541.379 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167986.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5375 bytes_read=11185 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.424 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167987.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5381 bytes_read=11291 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.05 cputime=3541.463 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167988.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5387 bytes_read=11427 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.505 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 167989.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5393 bytes_read=11533 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.05 cputime=3541.548 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167990.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5399 bytes_read=11639 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.592 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167991.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5405 bytes_read=11788 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.05 cputime=3541.638 memavail=666888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.4 pwm=0.000
Stats 167992.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5411 bytes_read=11894 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.04 cputime=3541.680 memavail=671368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167993.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5417 bytes_read=12000 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.7 pwm=0.000 sysload=0.04 cputime=3541.721 memavail=671368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 167994.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5423 bytes_read=12130 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.8 pwm=0.000 sysload=0.04 cputime=3541.764 memavail=671368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.3 pwm=0.000
Stats 170312.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=22926 bytes_read=288195 bytes_retransmit=0 bytes_invalid=0 send_seq=3002 receive_seq=3002 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003474  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.10 cputime=3635.538 memavail=672676 print_time=2377.915 buffer_time=0.417 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946668096: Disconnected
Restarting printer
Start printer at Wed Sep 20 18:59:36 2023 (1695250776.9 170313.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946642776: New connection
webhooks client 1946642776: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 170319.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2950 bytes_read=5472 bytes_retransmit=9 bytes_invalid=0 send_seq=205 receive_seq=202 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1622 upcoming_bytes=311 freq=71987968  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.17 cputime=3639.456 memavail=672728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946642776
webhooks: registering remote method 'reboot_machine' for connection id: 1946642776
webhooks: registering remote method 'pause_job_queue' for connection id: 1946642776
webhooks: registering remote method 'start_job_queue' for connection id: 1946642776
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946642776
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946642776
webhooks: registering remote method 'timelapse_render' for connection id: 1946642776
Stats 170320.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5092 bytes_read=5743 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72000683  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.17 cputime=3639.550 memavail=672740 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170321.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5131 bytes_read=5859 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72001369  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.17 cputime=3639.629 memavail=672028 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170322.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5137 bytes_read=5980 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002076  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.15 cputime=3639.676 memavail=672028 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170323.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5143 bytes_read=6101 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002406  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.15 cputime=3639.721 memavail=672028 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170324.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000253 mcu_task_stddev=0.000450 bytes_write=5149 bytes_read=6224 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002442  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.15 cputime=3639.766 memavail=672028 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170325.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000253 mcu_task_stddev=0.000450 bytes_write=5155 bytes_read=6345 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002565  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.15 cputime=3639.815 memavail=671776 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170326.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000253 mcu_task_stddev=0.000450 bytes_write=5161 bytes_read=6466 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002705  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.15 cputime=3639.862 memavail=671560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170327.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000253 mcu_task_stddev=0.000450 bytes_write=5167 bytes_read=6572 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002754  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.14 cputime=3639.903 memavail=671560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170328.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000253 mcu_task_stddev=0.000450 bytes_write=5173 bytes_read=6693 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002798  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.14 cputime=3639.949 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170329.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5179 bytes_read=6827 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002905  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.14 cputime=3639.995 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170330.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5185 bytes_read=6933 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002939  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.14 cputime=3640.041 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170331.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5191 bytes_read=7054 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002969  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.14 cputime=3640.088 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170332.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5197 bytes_read=7175 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003086  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.13 cputime=3640.135 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170333.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5203 bytes_read=7281 bytes_retransmit=9 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003124  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.13 cputime=3640.181 memavail=671336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170334.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5209 bytes_read=7415 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003137  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.13 cputime=3640.225 memavail=676068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170335.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5215 bytes_read=7536 bytes_retransmit=9 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003164  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.13 cputime=3640.267 memavail=673924 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 170336.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5221 bytes_read=7642 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003172  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.13 cputime=3640.369 memavail=673452 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170337.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5233 bytes_read=7779 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003235  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.12 cputime=3640.413 memavail=673004 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170338.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5239 bytes_read=7900 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003238  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.12 cputime=3640.452 memavail=672556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170339.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5245 bytes_read=8019 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003244  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.12 cputime=3640.492 memavail=672556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170340.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5251 bytes_read=8140 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003253  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.12 cputime=3640.532 memavail=671660 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170341.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5257 bytes_read=8261 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003272  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.12 cputime=3640.571 memavail=670796 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170342.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5263 bytes_read=8367 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003277  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.11 cputime=3640.611 memavail=670928 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170343.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5269 bytes_read=8488 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003282  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.11 cputime=3640.651 memavail=670992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170344.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5275 bytes_read=8609 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003296  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.11 cputime=3640.692 memavail=670800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170345.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5281 bytes_read=8728 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003330  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.11 cputime=3640.734 memavail=673636 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170346.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5287 bytes_read=8849 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003333  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.11 cputime=3640.773 memavail=677948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170347.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5293 bytes_read=8970 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003338  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.10 cputime=3640.815 memavail=677052 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170348.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5299 bytes_read=9076 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003340  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.10 cputime=3640.855 memavail=676160 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170349.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5305 bytes_read=9197 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003390  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.10 cputime=3640.895 memavail=675264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170350.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5311 bytes_read=9331 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003389  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.10 cputime=3640.936 memavail=675040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170351.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5317 bytes_read=9437 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003387  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.10 cputime=3640.978 memavail=675040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170352.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5323 bytes_read=9558 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003406  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.09 cputime=3641.021 memavail=675040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170353.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5329 bytes_read=9679 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003407  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.09 cputime=3641.065 memavail=675040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170354.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5335 bytes_read=9798 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003404  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.09 cputime=3641.109 memavail=675040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170355.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5341 bytes_read=9919 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003400  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.09 cputime=3641.153 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170356.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5347 bytes_read=10040 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003426  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.09 cputime=3641.196 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170357.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5353 bytes_read=10146 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003422  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.239 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170358.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5359 bytes_read=10267 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003418  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.08 cputime=3641.282 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170359.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5365 bytes_read=10388 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003414  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.08 cputime=3641.325 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170360.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5371 bytes_read=10507 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003417  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.369 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170361.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5377 bytes_read=10628 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003414  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.412 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170362.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5383 bytes_read=10749 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003412  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.08 cputime=3641.455 memavail=678628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170363.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5389 bytes_read=10855 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003414  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.492 memavail=674268 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170364.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5395 bytes_read=10976 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003417  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.528 memavail=677360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170365.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5401 bytes_read=11110 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003420  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.573 memavail=676608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170366.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5407 bytes_read=11216 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003423  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3641.615 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170367.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5413 bytes_read=11337 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003422  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.07 cputime=3641.658 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170368.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5419 bytes_read=11458 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003422  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.07 cputime=3641.702 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170369.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5425 bytes_read=11564 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003421  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.07 cputime=3641.743 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.2 pwm=0.000
Stats 170370.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5431 bytes_read=11698 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003421  heater_bed: target=0 temp=27.5 pwm=0.000 sysload=0.07 cputime=3641.786 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170371.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5437 bytes_read=11819 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003422  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.07 cputime=3641.829 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170372.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5443 bytes_read=11925 bytes_retransmit=9 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003426  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.07 cputime=3641.870 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.1 pwm=0.000
Stats 170373.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5449 bytes_read=12040 bytes_retransmit=9 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003426  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.07 cputime=3641.912 memavail=676616 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Stats 170441.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5863 bytes_read=20099 bytes_retransmit=9 bytes_invalid=0 send_seq=371 receive_seq=371 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003457  heater_bed: target=0 temp=27.4 pwm=0.000 sysload=0.08 cputime=3644.709 memavail=677252 print_time=128.204 buffer_time=0.766 print_stall=0 extruder: target=0 temp=29.0 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946642776: Disconnected
Restarting printer
Start printer at Wed Sep 20 19:01:46 2023 (1695250906.3 170443.2)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946510888: New connection
webhooks client 1946510888: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 170448.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2943 bytes_read=5487 bytes_retransmit=9 bytes_invalid=0 send_seq=203 receive_seq=200 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1779 upcoming_bytes=154 freq=72008216  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.15 cputime=3648.584 memavail=676248 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946510888
webhooks: registering remote method 'reboot_machine' for connection id: 1946510888
webhooks: registering remote method 'pause_job_queue' for connection id: 1946510888
webhooks: registering remote method 'start_job_queue' for connection id: 1946510888
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946510888
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946510888
webhooks: registering remote method 'timelapse_render' for connection id: 1946510888
Stats 170449.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5094 bytes_read=5823 bytes_retransmit=9 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72006846  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.15 cputime=3648.679 memavail=676044 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170450.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5100 bytes_read=5929 bytes_retransmit=9 bytes_invalid=0 send_seq=245 receive_seq=245 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004734  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.15 cputime=3648.745 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170451.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5106 bytes_read=6050 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72005528  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.15 cputime=3648.804 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170452.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5112 bytes_read=6171 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004542  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.13 cputime=3648.846 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170453.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5118 bytes_read=6294 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004003  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.13 cputime=3648.885 memavail=675820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Running Command {update_git_script}...:
bash: /home/klipper/printer_data/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 170454.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5124 bytes_read=6415 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003799  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.13 cputime=3648.987 memavail=675596 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170455.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5130 bytes_read=6536 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003650  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.13 cputime=3649.020 memavail=674644 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170456.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5136 bytes_read=6642 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003849  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.13 cputime=3649.061 memavail=674196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170457.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000267 mcu_task_stddev=0.000460 bytes_write=5142 bytes_read=6763 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003722  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.12 cputime=3649.101 memavail=674196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170458.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5148 bytes_read=6897 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003672  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.12 cputime=3649.141 memavail=674200 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 170459.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5154 bytes_read=7003 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003627  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.12 cputime=3649.180 memavail=674200 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170460.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5160 bytes_read=7124 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003672  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.12 cputime=3649.220 memavail=674200 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170461.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5166 bytes_read=7245 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003616  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.12 cputime=3649.261 memavail=674200 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170462.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5172 bytes_read=7351 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003592  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.11 cputime=3649.300 memavail=674200 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170463.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5178 bytes_read=7485 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003565  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.11 cputime=3649.340 memavail=673528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170464.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5184 bytes_read=7606 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003559  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.11 cputime=3649.380 memavail=672632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170465.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5190 bytes_read=7712 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.11 cputime=3649.418 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170466.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5202 bytes_read=7849 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003528  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.11 cputime=3649.463 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170467.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5208 bytes_read=7970 bytes_retransmit=9 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.10 cputime=3649.506 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170468.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5214 bytes_read=8089 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.10 cputime=3649.547 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170469.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5220 bytes_read=8210 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.590 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170470.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5226 bytes_read=8331 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.634 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170471.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5232 bytes_read=8437 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.10 cputime=3649.676 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170472.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5238 bytes_read=8558 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.719 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170473.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5244 bytes_read=8692 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.763 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170474.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5250 bytes_read=8798 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.10 cputime=3649.806 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170475.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5256 bytes_read=8919 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.847 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170476.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5262 bytes_read=9040 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.10 cputime=3649.890 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170477.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5268 bytes_read=9146 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.09 cputime=3649.933 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170478.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5274 bytes_read=9280 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.09 cputime=3649.978 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170479.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5280 bytes_read=9401 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.09 cputime=3650.021 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170480.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5286 bytes_read=9507 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.09 cputime=3650.062 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170481.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5292 bytes_read=9628 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.09 cputime=3650.106 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170482.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5298 bytes_read=9749 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.08 cputime=3650.150 memavail=670736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170483.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5304 bytes_read=9868 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.08 cputime=3650.194 memavail=668484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170484.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5310 bytes_read=10004 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.08 cputime=3650.221 memavail=671464 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170485.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5316 bytes_read=10110 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.08 cputime=3650.256 memavail=671240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170486.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5322 bytes_read=10216 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.08 cputime=3650.299 memavail=671240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170487.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5328 bytes_read=10352 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.07 cputime=3650.344 memavail=671240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170488.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5334 bytes_read=10458 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.07 cputime=3650.388 memavail=671244 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170489.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5340 bytes_read=10577 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.07 cputime=3650.431 memavail=676292 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170490.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5346 bytes_read=10713 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.07 cputime=3650.474 memavail=674696 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170491.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5352 bytes_read=10819 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.07 cputime=3650.513 memavail=674024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170492.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5358 bytes_read=10925 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.15 cputime=3650.552 memavail=672904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170493.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5364 bytes_read=11061 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.15 cputime=3650.593 memavail=672008 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170494.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5370 bytes_read=11180 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.15 cputime=3650.633 memavail=671880 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170495.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5376 bytes_read=11286 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003510  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.15 cputime=3650.672 memavail=676060 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170496.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5382 bytes_read=11422 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003510  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.15 cputime=3650.713 memavail=675612 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170497.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5388 bytes_read=11528 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.14 cputime=3650.754 memavail=675612 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170498.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5394 bytes_read=11634 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.14 cputime=3650.796 memavail=675612 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170499.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5400 bytes_read=11783 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.14 cputime=3650.835 memavail=675116 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170500.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5406 bytes_read=11889 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.14 cputime=3650.864 memavail=674864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 170501.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5412 bytes_read=11995 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003485  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.14 cputime=3650.905 memavail=674864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 170502.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5418 bytes_read=12125 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003485  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.12 cputime=3650.949 memavail=674864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
webhooks client 1946510888: Disconnected
Starting Klippy...
Args: ['/home/Klipper/klipper/klippy/klippy.py', '/home/Klipper/printer_data/config/printer.cfg', '-l', '/home/Klipper/printer_data/logs/klippy.log', '-I', '/home/Klipper/printer_data/comms/klippy.serial', '-a', '/home/Klipper/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-275-g8ef0f7d7-dirty'
Untracked files: klippy/extras/gcode_shell_command.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper.git
CPU: 4 core ARMv7 Processor rev 4 (v7l)
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Wed Sep 20 19:05:17 2023 (1695251117.7 20.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
mcu 'mcu': got {'oid': 15, 'next_clock': 3685898112, 'value': 31150, '#name': 'analog_in_state', '#sent_time': 26.434054469000003, '#receive_time': 26.481157646}
mcu 'mcu': got {'oid': 21, 'next_clock': 3690218112, 'value': 31041, '#name': 'analog_in_state', '#sent_time': 26.489543219, '#receive_time': 26.541357959000003}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
webhooks client 1965338928: New connection
webhooks client 1965338928: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
webhooks: registering remote method 'shutdown_machine' for connection id: 1965338928
webhooks: registering remote method 'reboot_machine' for connection id: 1965338928
webhooks: registering remote method 'pause_job_queue' for connection id: 1965338928
webhooks: registering remote method 'start_job_queue' for connection id: 1965338928
webhooks: registering remote method 'timelapse_newframe' for connection id: 1965338928
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1965338928
webhooks: registering remote method 'timelapse_render' for connection id: 1965338928
Running Command {update_git_script}...:
bash: /home/klipper/printer_data/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 73.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5276 bytes_read=11166 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003412  heater_bed: target=0 temp=27.0 pwm=0.000 sysload=1.10 cputime=7.511 memavail=693324 print_time=277.637 buffer_time=0.833 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1965338928: Disconnected
Restarting printer
Start printer at Wed Sep 20 19:06:25 2023 (1695251185.1 75.4)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1964805784: New connection
webhooks client 1964805784: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 80.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1827 upcoming_bytes=154 freq=72002945  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.00 cputime=11.417 memavail=692192 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1964805784
webhooks: registering remote method 'reboot_machine' for connection id: 1964805784
webhooks: registering remote method 'pause_job_queue' for connection id: 1964805784
webhooks: registering remote method 'start_job_queue' for connection id: 1964805784
webhooks: registering remote method 'timelapse_newframe' for connection id: 1964805784
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1964805784
webhooks: registering remote method 'timelapse_render' for connection id: 1964805784
Stats 81.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5082 bytes_read=5718 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002535  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=1.00 cputime=11.508 memavail=692232 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 82.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5126 bytes_read=5854 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=1.00 cputime=11.581 memavail=691984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 83.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5132 bytes_read=5960 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003623  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=1.00 cputime=11.633 memavail=696724 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Running Command {update_git_script}...:
bash: /home/klipper/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 84.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5138 bytes_read=6081 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003457  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=1.00 cputime=11.732 memavail=694320 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 85.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5144 bytes_read=6219 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003461  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.92 cputime=11.764 memavail=693440 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 86.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5150 bytes_read=6325 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003470  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.92 cputime=11.812 memavail=693000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 87.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5156 bytes_read=6446 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003442  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.92 cputime=11.856 memavail=693000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 88.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5162 bytes_read=6567 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.92 cputime=11.901 memavail=693000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 89.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5168 bytes_read=6673 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.92 cputime=11.940 memavail=693000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 90.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5174 bytes_read=6807 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.93 cputime=11.979 memavail=692776 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 91.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5180 bytes_read=6928 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003579  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.93 cputime=12.018 memavail=691656 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 92.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5186 bytes_read=7034 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.93 cputime=12.057 memavail=691016 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 93.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5192 bytes_read=7155 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.93 cputime=12.096 memavail=691112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 94.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5198 bytes_read=7276 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.93 cputime=12.136 memavail=690860 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 95.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5204 bytes_read=7395 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.94 cputime=12.179 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 96.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5210 bytes_read=7516 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003485  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.94 cputime=12.222 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 97.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5216 bytes_read=7637 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.94 cputime=12.267 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 98.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5228 bytes_read=7743 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.94 cputime=12.312 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 99.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5234 bytes_read=7880 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.94 cputime=12.355 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 100.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5240 bytes_read=8001 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.86 cputime=12.398 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 101.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5246 bytes_read=8120 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.86 cputime=12.444 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 102.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5252 bytes_read=8241 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.86 cputime=12.491 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 103.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5258 bytes_read=8362 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.86 cputime=12.536 memavail=690872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 104.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5264 bytes_read=8468 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003547  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.86 cputime=12.579 memavail=690620 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 105.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5270 bytes_read=8604 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.79 cputime=12.626 memavail=690632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 106.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5276 bytes_read=8723 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.79 cputime=12.669 memavail=690632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 107.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5282 bytes_read=8829 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.79 cputime=12.711 memavail=690632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 108.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5288 bytes_read=8965 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.79 cputime=12.752 memavail=690984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 109.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5294 bytes_read=9071 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.79 cputime=12.793 memavail=690984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 110.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5300 bytes_read=9177 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.73 cputime=12.836 memavail=690984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 111.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5306 bytes_read=9326 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.73 cputime=12.880 memavail=690984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 112.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5312 bytes_read=9432 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003571  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.73 cputime=12.921 memavail=690732 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 113.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5318 bytes_read=9538 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003562  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.73 cputime=12.963 memavail=690732 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 114.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5324 bytes_read=9674 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.73 cputime=13.008 memavail=690740 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 115.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5330 bytes_read=9780 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.67 cputime=13.052 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 116.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5336 bytes_read=9899 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.67 cputime=13.097 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 117.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5342 bytes_read=10035 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.67 cputime=13.142 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 118.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5348 bytes_read=10141 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003555  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.67 cputime=13.186 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 119.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5354 bytes_read=10247 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.67 cputime=13.231 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 120.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5360 bytes_read=10383 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.62 cputime=13.276 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 121.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5366 bytes_read=10502 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.62 cputime=13.321 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 122.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5372 bytes_read=10608 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=27.3 pwm=0.000 sysload=0.62 cputime=13.365 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 123.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5378 bytes_read=10744 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.62 cputime=13.411 memavail=690760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 124.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5384 bytes_read=10850 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.62 cputime=13.455 memavail=690256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 125.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5390 bytes_read=10956 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.57 cputime=13.500 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 126.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5396 bytes_read=11105 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.57 cputime=13.544 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 127.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5402 bytes_read=11211 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.57 cputime=13.588 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 128.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5408 bytes_read=11317 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003528  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.57 cputime=13.631 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 129.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5414 bytes_read=11453 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.57 cputime=13.676 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 130.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5420 bytes_read=11559 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.52 cputime=13.720 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 131.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5426 bytes_read=11678 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.52 cputime=13.765 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 132.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5432 bytes_read=11814 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.52 cputime=13.810 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 133.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5438 bytes_read=11920 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.52 cputime=13.854 memavail=690276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 134.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5444 bytes_read=12022 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.52 cputime=13.898 memavail=689540 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 218.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5993 bytes_read=22005 bytes_retransmit=0 bytes_invalid=0 send_seq=389 receive_seq=389 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.12 cputime=17.363 memavail=695884 print_time=143.595 buffer_time=0.215 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1964805784: Disconnected
Restarting printer
Start printer at Wed Sep 20 19:08:49 2023 (1695251329.9 220.2)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1970548664: New connection
webhooks client 1970548664: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 225.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=3155 bytes_read=5507 bytes_retransmit=9 bytes_invalid=0 send_seq=207 receive_seq=204 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1635 upcoming_bytes=106 freq=72006399  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.27 cputime=21.230 memavail=695224 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1970548664
webhooks: registering remote method 'reboot_machine' for connection id: 1970548664
webhooks: registering remote method 'pause_job_queue' for connection id: 1970548664
webhooks: registering remote method 'start_job_queue' for connection id: 1970548664
webhooks: registering remote method 'timelapse_newframe' for connection id: 1970548664
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1970548664
webhooks: registering remote method 'timelapse_render' for connection id: 1970548664
Stats 226.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5077 bytes_read=5758 bytes_retransmit=9 bytes_invalid=0 send_seq=243 receive_seq=243 retransmit_seq=2 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003238  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=21.321 memavail=694976 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 227.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5105 bytes_read=5889 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003395  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=21.392 memavail=694856 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 228.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5111 bytes_read=6010 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003570  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=21.449 memavail=694632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 229.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5117 bytes_read=6116 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=21.490 memavail=693960 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Running Command {update_git_script}...:
grep: /home/Klipper/klipper-backup/.env: No such file or directory

grep: /home/Klipper/klipper-backup/.env: No such file or directory

grep: /home/Klipper/klipper-backup/.env: No such file or directory

grep: /home/Klipper/klipper-backup/.env: No such file or directory

grep: /home/Klipper/klipper-backup/.env: No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

Stats 230.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000461 bytes_write=5123 bytes_read=6254 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003474  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=21.561 memavail=691884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 231.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000461 bytes_write=5129 bytes_read=6375 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003438  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.47 cputime=21.598 memavail=692396 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 232.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000461 bytes_write=5135 bytes_read=6481 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003440  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.47 cputime=21.646 memavail=691500 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 233.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000461 bytes_write=5141 bytes_read=6602 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.47 cputime=21.693 memavail=691372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 234.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000461 bytes_write=5147 bytes_read=6723 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.47 cputime=21.740 memavail=691468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 235.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5153 bytes_read=6842 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.47 cputime=21.790 memavail=690140 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 236.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5159 bytes_read=6963 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.51 cputime=21.839 memavail=690236 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 237.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5165 bytes_read=7084 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003478  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.51 cputime=21.888 memavail=694276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 238.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5171 bytes_read=7190 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.51 cputime=21.937 memavail=693604 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 239.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5177 bytes_read=7311 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.51 cputime=21.986 memavail=692484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 240.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5183 bytes_read=7445 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.51 cputime=22.035 memavail=691588 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/40) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'
index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

Stats 241.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5189 bytes_read=7551 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.47 cputime=22.085 memavail=691328 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
fatal: could not read Username for 'https://github.com': No such device or address

Command {update_git_script} finished

Stats 242.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5195 bytes_read=7672 bytes_retransmit=9 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.47 cputime=22.137 memavail=696752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 243.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5207 bytes_read=7809 bytes_retransmit=9 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.47 cputime=22.177 memavail=696752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 244.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5213 bytes_read=7915 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.47 cputime=22.216 memavail=696500 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 245.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5219 bytes_read=8049 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003532  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.47 cputime=22.257 memavail=695512 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 246.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5225 bytes_read=8170 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.43 cputime=22.297 memavail=695288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 247.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5231 bytes_read=8276 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.43 cputime=22.337 memavail=694392 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 248.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5237 bytes_read=8397 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003572  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.43 cputime=22.377 memavail=693496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 249.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5243 bytes_read=8518 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003561  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.43 cputime=22.418 memavail=692600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 250.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5249 bytes_read=8637 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.43 cputime=22.459 memavail=692440 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 251.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5255 bytes_read=8758 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.40 cputime=22.500 memavail=692312 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 252.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5261 bytes_read=8879 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.40 cputime=22.541 memavail=692312 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 253.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5267 bytes_read=9000 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.40 cputime=22.582 memavail=692312 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 254.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5273 bytes_read=9106 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.40 cputime=22.623 memavail=692344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 255.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5279 bytes_read=9227 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.40 cputime=22.663 memavail=691260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 256.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5285 bytes_read=9361 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=27.0 pwm=0.000 sysload=0.36 cputime=22.704 memavail=691388 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 257.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5291 bytes_read=9467 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.36 cputime=22.744 memavail=691484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.5 pwm=0.000
Stats 258.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5297 bytes_read=9588 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.36 cputime=22.785 memavail=691612 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.9 pwm=0.000
Stats 259.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5303 bytes_read=9709 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.36 cputime=22.825 memavail=691484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 260.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5309 bytes_read=9815 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.36 cputime=22.864 memavail=696032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 261.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5315 bytes_read=9949 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=22.906 memavail=695136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 262.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5321 bytes_read=10070 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=22.946 memavail=693988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 263.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5327 bytes_read=10176 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=22.986 memavail=693092 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 264.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5333 bytes_read=10297 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=23.026 memavail=692196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 265.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5339 bytes_read=10418 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.33 cputime=23.065 memavail=691068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 266.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5345 bytes_read=10537 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.39 cputime=23.105 memavail=695872 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 267.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5351 bytes_read=10658 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.39 cputime=23.146 memavail=694248 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 268.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5357 bytes_read=10779 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.39 cputime=23.187 memavail=693352 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 269.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5363 bytes_read=10885 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.39 cputime=23.228 memavail=692680 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 270.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5369 bytes_read=11006 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.39 cputime=23.270 memavail=691560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 271.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5375 bytes_read=11140 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.44 cputime=23.310 memavail=690920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 272.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5381 bytes_read=11246 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003513  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.44 cputime=23.350 memavail=691048 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 273.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5387 bytes_read=11367 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.44 cputime=23.390 memavail=690920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 274.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5393 bytes_read=11488 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.44 cputime=23.430 memavail=691048 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 275.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5399 bytes_read=11594 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.44 cputime=23.461 memavail=696496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 276.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5405 bytes_read=11728 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.48 cputime=23.499 memavail=695600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Stats 277.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5411 bytes_read=11849 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.48 cputime=23.539 memavail=694928 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.8 pwm=0.000
Stats 278.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5417 bytes_read=11955 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.48 cputime=23.578 memavail=694032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.6 pwm=0.000
Stats 279.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5423 bytes_read=12071 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=27.2 pwm=0.000 sysload=0.48 cputime=23.618 memavail=693648 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot create directory '/home/Klipper/klipper-backup//home/Klipper/klipper-backup/printer_data': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/40) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

To https://github.com/Scooby7274/sovol_klipper.git
 * [new branch]      main -> main

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot create directory '/home/Klipper/klipper-backup//home/Klipper/klipper-backup/printer_data': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/40) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Unknown command:"FILTER_BRANCH_SQUELCH_WARNING=1"
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot create directory '/home/Klipper/klipper-backup//home/Klipper/klipper-backup/printer_data': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/40) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: cannot create directory '/home/Klipper/klipper-backup//home/Klipper/klipper-backup/printer_data': No such file or directory

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/40) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Running Command {update_git_script}...:

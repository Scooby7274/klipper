=============== Log rollover at Tue Sep 19 18:56:30 2023 ===============
Starting Klippy...
Args: ['/home/Klipper/klipper/klippy/klippy.py', '/home/Klipper/printer_data/config/printer.cfg', '-l', '/home/Klipper/printer_data/logs/klippy.log', '-I', '/home/Klipper/printer_data/comms/klippy.serial', '-a', '/home/Klipper/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-275-g8ef0f7d7-dirty'
Untracked files: klippy/extras/gcode_shell_command.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper.git
CPU: 4 core ARMv7 Processor rev 4 (v7l)
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Tue Sep 19 18:56:31 2023 (1695164191.7 83728.0)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1963824656: New connection
webhooks client 1963824656: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
mcu 'mcu': got {'oid': 15, 'next_clock': 2241315200, 'value': 31142, '#name': 'analog_in_state', '#sent_time': 83732.403989517, '#receive_time': 83732.424906861}
mcu 'mcu': got {'oid': 21, 'next_clock': 2245635200, 'value': 31030, '#name': 'analog_in_state', '#sent_time': 83732.46021800699, '#receive_time': 83732.485207903}
mcu 'mcu': got {'oid': 15, 'next_clock': 2262915200, 'value': 31141, '#name': 'analog_in_state', '#sent_time': 83732.681399257, '#receive_time': 83732.724544569}
mcu 'mcu': got {'oid': 21, 'next_clock': 2267235200, 'value': 31029, '#name': 'analog_in_state', '#sent_time': 83732.736675246, '#receive_time': 83732.784792486}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
webhooks: registering remote method 'shutdown_machine' for connection id: 1963824656
webhooks: registering remote method 'reboot_machine' for connection id: 1963824656
webhooks: registering remote method 'pause_job_queue' for connection id: 1963824656
webhooks: registering remote method 'start_job_queue' for connection id: 1963824656
webhooks: registering remote method 'timelapse_newframe' for connection id: 1963824656
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1963824656
webhooks: registering remote method 'timelapse_render' for connection id: 1963824656
Stats 84131.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=7451 bytes_read=52816 bytes_retransmit=9 bytes_invalid=0 send_seq=642 receive_seq=642 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003468  heater_bed: target=0 temp=27.1 pwm=0.000 sysload=0.01 cputime=20.938 memavail=684936 print_time=77978.079 buffer_time=0.514 print_stall=0 extruder: target=0 temp=28.7 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1963824656: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:03:16 2023 (1695164596.5 84132.8)
Config error
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/Klipper/klipper/klippy/klippy.py", line 134, in _read_config
    config = pconfig.read_main_config()
  File "/home/Klipper/klipper/klippy/configfile.py", line 281, in read_main_config
    regular_config = self._build_config_wrapper(regular_data, filename)
  File "/home/Klipper/klipper/klippy/configfile.py", line 268, in _build_config_wrapper
    self._parse_config(data, filename, fileconfig, set())
  File "/home/Klipper/klipper/klippy/configfile.py", line 260, in _parse_config
    self._parse_config_buffer(buffer, filename, fileconfig)
  File "/home/Klipper/klipper/klippy/configfile.py", line 220, in _parse_config_buffer
    fileconfig.readfp(sbuffer, filename)
  File "/usr/lib/python3.9/configparser.py", line 763, in readfp
    self.read_file(fp, source=filename)
  File "/usr/lib/python3.9/configparser.py", line 718, in read_file
    self._read(f, source)
  File "/usr/lib/python3.9/configparser.py", line 1113, in _read
    raise e
configparser.ParsingError: Source contains parsing errors: '/home/Klipper/printer_data/config/printer.cfg'
	[line 233]: 'Github Backup\n'
webhooks client 1964634088: New connection
webhooks client 1964634088: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
webhooks client 1964634088: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:05:33 2023 (1695164733.1 84269.4)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946495920: New connection
webhooks client 1946495920: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
webhooks: registering remote method 'shutdown_machine' for connection id: 1946495920
webhooks: registering remote method 'reboot_machine' for connection id: 1946495920
webhooks: registering remote method 'pause_job_queue' for connection id: 1946495920
webhooks: registering remote method 'start_job_queue' for connection id: 1946495920
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946495920
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946495920
webhooks: registering remote method 'timelapse_render' for connection id: 1946495920
Stats 84989.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=10172 bytes_read=90587 bytes_retransmit=9 bytes_invalid=0 send_seq=1045 receive_seq=1044 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=19 upcoming_bytes=0 freq=72003465  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.23 cputime=54.617 memavail=686232 print_time=857.005 buffer_time=0.712 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946495920: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:17:34 2023 (1695165454.7 84991.0)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946520616: New connection
webhooks client 1946520616: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 84996.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1619 upcoming_bytes=362 freq=72008211  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.19 cputime=58.548 memavail=685880 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946520616
webhooks: registering remote method 'reboot_machine' for connection id: 1946520616
webhooks: registering remote method 'pause_job_queue' for connection id: 1946520616
webhooks: registering remote method 'start_job_queue' for connection id: 1946520616
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946520616
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946520616
webhooks: registering remote method 'timelapse_render' for connection id: 1946520616
Stats 84997.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5082 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004877  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.19 cputime=58.660 memavail=685640 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 84998.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003812  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.19 cputime=58.710 memavail=685704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 84999.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5955 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003608  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.19 cputime=58.763 memavail=685704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85000.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.19 cputime=58.802 memavail=684584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85001.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000260 mcu_task_stddev=0.000455 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.18 cputime=58.841 memavail=684192 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85002.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000260 mcu_task_stddev=0.000455 bytes_write=5145 bytes_read=6320 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.18 cputime=58.879 memavail=683972 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85003.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000260 mcu_task_stddev=0.000455 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.18 cputime=58.919 memavail=683972 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85004.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000260 mcu_task_stddev=0.000455 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.18 cputime=58.959 memavail=683524 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85005.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000260 mcu_task_stddev=0.000455 bytes_write=5163 bytes_read=6668 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.18 cputime=58.997 memavail=683524 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85006.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.16 cputime=59.036 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85007.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.16 cputime=59.073 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85008.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7029 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003621  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.16 cputime=59.114 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85009.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003573  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.16 cputime=59.157 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85010.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.16 cputime=59.199 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85011.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7390 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003587  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.15 cputime=59.241 memavail=682352 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85012.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003583  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.15 cputime=59.283 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85013.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003577  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.15 cputime=59.324 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85014.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7754 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.15 cputime=59.367 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85015.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003561  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.15 cputime=59.409 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85016.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003559  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.14 cputime=59.451 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85017.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8115 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003602  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.14 cputime=59.492 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85018.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003578  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=59.535 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85019.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003566  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=59.576 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85020.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8463 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=59.617 memavail=682356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85021.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.12 cputime=59.659 memavail=681096 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85022.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.12 cputime=59.699 memavail=681100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85023.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8824 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=59.740 memavail=681100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85024.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=59.782 memavail=681328 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85025.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=59.824 memavail=681328 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85026.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9172 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=59.865 memavail=681356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85027.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.11 cputime=59.909 memavail=681356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85028.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=59.954 memavail=681356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85029.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9533 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.11 cputime=59.997 memavail=681356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85030.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.11 cputime=60.042 memavail=681356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85031.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9775 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=60.085 memavail=685744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85032.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9894 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=60.125 memavail=684280 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85033.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=60.159 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85034.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=60.204 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85035.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10242 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=60.247 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85036.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.10 cputime=60.291 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85037.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.10 cputime=60.333 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85038.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10618 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.10 cputime=60.374 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85039.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.10 cputime=60.415 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85040.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.10 cputime=60.456 memavail=690728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85041.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10966 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.09 cputime=60.498 memavail=689736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85042.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.09 cputime=60.541 memavail=689736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85043.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.09 cputime=60.583 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85044.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11327 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.09 cputime=60.622 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85045.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.09 cputime=60.663 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.5 pwm=0.000
Stats 85046.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.08 cputime=60.706 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85047.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11688 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.08 cputime=60.748 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85048.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=60.791 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85049.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=60.832 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85050.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12031 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=60.875 memavail=689288 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85099.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5772 bytes_read=17853 bytes_retransmit=0 bytes_invalid=0 send_seq=352 receive_seq=352 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=62.855 memavail=686632 print_time=108.693 buffer_time=0.365 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946520616: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:19:24 2023 (1695165564.5 85100.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1964250856: New connection
webhooks client 1964250856: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 85106.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=2842 bytes_read=5482 bytes_retransmit=9 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1482 upcoming_bytes=547 freq=72007468  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=66.693 memavail=685932 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1964250856
webhooks: registering remote method 'reboot_machine' for connection id: 1964250856
webhooks: registering remote method 'pause_job_queue' for connection id: 1964250856
webhooks: registering remote method 'start_job_queue' for connection id: 1964250856
webhooks: registering remote method 'timelapse_newframe' for connection id: 1964250856
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1964250856
webhooks: registering remote method 'timelapse_render' for connection id: 1964250856
Stats 85107.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5104 bytes_read=5833 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72005965  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=66.819 memavail=685688 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85108.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5110 bytes_read=5939 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003706  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=66.867 memavail=685692 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85109.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5116 bytes_read=6060 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=66.924 memavail=685700 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85110.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5122 bytes_read=6181 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003593  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.12 cputime=66.969 memavail=685700 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85111.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000462 bytes_write=5128 bytes_read=6304 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003632  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=67.012 memavail=685700 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85112.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000462 bytes_write=5134 bytes_read=6425 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003459  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=67.044 memavail=684704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85113.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000462 bytes_write=5140 bytes_read=6546 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003428  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=67.082 memavail=684256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85114.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000462 bytes_write=5146 bytes_read=6652 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003449  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=67.120 memavail=683360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85115.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000462 bytes_write=5152 bytes_read=6773 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003436  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.11 cputime=67.159 memavail=682464 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85116.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5158 bytes_read=6907 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003438  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.10 cputime=67.197 memavail=681792 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85117.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5164 bytes_read=7013 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003439  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.10 cputime=67.236 memavail=680900 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85118.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5170 bytes_read=7134 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003448  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.10 cputime=67.277 memavail=680772 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85119.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5176 bytes_read=7255 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003471  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.10 cputime=67.318 memavail=680900 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85120.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5182 bytes_read=7361 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003450  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.10 cputime=67.356 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85121.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5188 bytes_read=7495 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003459  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.09 cputime=67.395 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85122.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5194 bytes_read=7616 bytes_retransmit=9 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003451  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.09 cputime=67.434 memavail=680720 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85123.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5200 bytes_read=7722 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003455  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.09 cputime=67.471 memavail=680720 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85124.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5212 bytes_read=7859 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003456  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.09 cputime=67.511 memavail=680816 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85125.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5218 bytes_read=7980 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.09 cputime=67.550 memavail=681072 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85126.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5224 bytes_read=8099 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.587 memavail=680848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85127.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5230 bytes_read=8220 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.624 memavail=680848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85128.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5236 bytes_read=8341 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.08 cputime=67.665 memavail=680848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85129.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5242 bytes_read=8447 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.08 cputime=67.706 memavail=680848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85130.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5248 bytes_read=8568 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.744 memavail=680656 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85131.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5254 bytes_read=8702 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.786 memavail=680784 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85132.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5260 bytes_read=8808 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.825 memavail=680628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85133.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5266 bytes_read=8929 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.08 cputime=67.864 memavail=680724 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/printer_data/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 85134.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5272 bytes_read=9050 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=67.965 memavail=684500 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85135.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5278 bytes_read=9156 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.08 cputime=68.003 memavail=683828 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85136.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5284 bytes_read=9290 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.07 cputime=68.042 memavail=682708 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85137.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5290 bytes_read=9411 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.07 cputime=68.081 memavail=682036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85138.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5296 bytes_read=9517 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.07 cputime=68.118 memavail=680920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85139.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5302 bytes_read=9638 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.07 cputime=68.157 memavail=685176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85140.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5308 bytes_read=9759 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.07 cputime=68.195 memavail=684056 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85141.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5314 bytes_read=9878 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.06 cputime=68.234 memavail=683160 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85142.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5320 bytes_read=9999 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=26.9 pwm=0.000 sysload=0.06 cputime=68.274 memavail=681764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85143.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5326 bytes_read=10120 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.06 cputime=68.316 memavail=680868 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85144.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5332 bytes_read=10226 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.06 cputime=68.360 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85145.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5338 bytes_read=10347 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.06 cputime=68.405 memavail=680612 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85146.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5344 bytes_read=10468 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.14 cputime=68.450 memavail=680740 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85147.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5350 bytes_read=10587 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.14 cputime=68.496 memavail=680868 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85148.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5356 bytes_read=10708 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.14 cputime=68.540 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85149.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5362 bytes_read=10829 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=68.579 memavail=680836 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85150.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5368 bytes_read=10935 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.14 cputime=68.618 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85151.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5374 bytes_read=11056 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.21 cputime=68.658 memavail=681284 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85152.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5380 bytes_read=11190 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.21 cputime=68.700 memavail=685352 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85153.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5386 bytes_read=11296 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.21 cputime=68.734 memavail=676096 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85154.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5392 bytes_read=11432 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.21 cputime=68.762 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85155.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5398 bytes_read=11538 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.21 cputime=68.803 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85156.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5404 bytes_read=11644 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.27 cputime=68.846 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85157.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5410 bytes_read=11793 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.27 cputime=68.890 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85158.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5416 bytes_read=11899 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.27 cputime=68.932 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85159.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5422 bytes_read=12005 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.27 cputime=68.973 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Stats 85160.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5428 bytes_read=12135 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.27 cputime=69.017 memavail=681036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.4 pwm=0.000
Stats 85270.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=6133 bytes_read=25184 bytes_retransmit=9 bytes_invalid=0 send_seq=414 receive_seq=414 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.20 cputime=73.629 memavail=684252 print_time=169.760 buffer_time=0.265 print_stall=0 extruder: target=0 temp=28.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1964250856: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:22:15 2023 (1695165735.5 85271.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1965508640: New connection
webhooks client 1965508640: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 85277.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2910 bytes_read=5432 bytes_retransmit=0 bytes_invalid=0 send_seq=197 receive_seq=194 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1928 upcoming_bytes=5 freq=72005234  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.31 cputime=77.520 memavail=682060 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1965508640
webhooks: registering remote method 'reboot_machine' for connection id: 1965508640
webhooks: registering remote method 'pause_job_queue' for connection id: 1965508640
webhooks: registering remote method 'start_job_queue' for connection id: 1965508640
webhooks: registering remote method 'timelapse_newframe' for connection id: 1965508640
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1965508640
webhooks: registering remote method 'timelapse_render' for connection id: 1965508640
Stats 85278.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5062 bytes_read=5688 bytes_retransmit=0 bytes_invalid=0 send_seq=239 receive_seq=238 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=7 upcoming_bytes=0 freq=72005242  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.31 cputime=77.643 memavail=681588 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 85279.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5101 bytes_read=5829 bytes_retransmit=0 bytes_invalid=0 send_seq=243 receive_seq=243 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004247  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.31 cputime=77.694 memavail=681368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85280.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5107 bytes_read=5935 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003798  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.31 cputime=77.742 memavail=681372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85281.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5113 bytes_read=6056 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=245 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003857  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.29 cputime=77.785 memavail=681372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85282.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5119 bytes_read=6194 bytes_retransmit=0 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003715  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.29 cputime=77.829 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85283.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5125 bytes_read=6300 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003614  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.29 cputime=77.869 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85284.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5131 bytes_read=6421 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003578  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.29 cputime=77.909 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85285.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5137 bytes_read=6542 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.29 cputime=77.952 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85286.0: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000268 mcu_task_stddev=0.000460 bytes_write=5143 bytes_read=6648 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.26 cputime=77.994 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85287.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5149 bytes_read=6782 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.26 cputime=78.037 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85288.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5155 bytes_read=6903 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.26 cputime=78.079 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85289.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5161 bytes_read=7009 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.26 cputime=78.120 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85290.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5167 bytes_read=7130 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003636  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.26 cputime=78.162 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85291.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5173 bytes_read=7251 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003608  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.24 cputime=78.205 memavail=686264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85292.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5179 bytes_read=7370 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.24 cputime=78.246 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85293.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5185 bytes_read=7491 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.24 cputime=78.287 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85294.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5191 bytes_read=7612 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.24 cputime=78.329 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85295.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5203 bytes_read=7734 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.24 cputime=78.371 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85296.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5209 bytes_read=7855 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.30 cputime=78.415 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85297.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5215 bytes_read=7976 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.30 cputime=78.458 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85298.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5221 bytes_read=8095 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.30 cputime=78.498 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85299.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5227 bytes_read=8231 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.30 cputime=78.541 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85300.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5233 bytes_read=8337 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.30 cputime=78.582 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85301.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5239 bytes_read=8443 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.28 cputime=78.623 memavail=685764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85302.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5245 bytes_read=8579 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.28 cputime=78.666 memavail=684520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85303.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5251 bytes_read=8698 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.28 cputime=78.707 memavail=684520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85304.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5257 bytes_read=8804 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.28 cputime=78.749 memavail=684520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85305.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5296 bytes_read=8950 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.28 cputime=78.798 memavail=684504 print_time=33.322 buffer_time=0.097 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1965508640: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:22:50 2023 (1695165770.0 85306.3)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946922120: New connection
webhooks client 1946922120: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 85311.6: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1875 upcoming_bytes=106 freq=72002068  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.32 cputime=82.714 memavail=683560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946922120
webhooks: registering remote method 'reboot_machine' for connection id: 1946922120
webhooks: registering remote method 'pause_job_queue' for connection id: 1946922120
webhooks: registering remote method 'start_job_queue' for connection id: 1946922120
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946922120
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946922120
webhooks: registering remote method 'timelapse_render' for connection id: 1946922120
Stats 85312.6: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5082 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72005851  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.32 cputime=82.833 memavail=683316 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85313.6: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004017  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.32 cputime=82.893 memavail=683068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85314.6: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5127 bytes_read=5970 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003953  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.32 cputime=82.937 memavail=683076 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85315.6: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004032  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.32 cputime=82.978 memavail=683076 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85316.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004620  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.29 cputime=83.018 memavail=682852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85317.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5145 bytes_read=6335 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004285  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.29 cputime=83.058 memavail=682628 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 85318.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004048  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.29 cputime=83.110 memavail=679952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85319.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003870  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.29 cputime=83.157 memavail=679280 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85320.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5163 bytes_read=6683 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003710  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.29 cputime=83.204 memavail=679152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85321.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003602  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.27 cputime=83.251 memavail=679024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85322.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.27 cputime=83.302 memavail=678580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85323.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7044 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.27 cputime=83.351 memavail=678484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85324.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.27 cputime=83.398 memavail=678580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85325.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.27 cputime=83.452 memavail=678580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85326.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7405 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003456  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.33 cputime=83.505 memavail=678580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85327.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.33 cputime=83.559 memavail=678580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Proceeding with filter-branch...


Cannot rewrite branches: You have unstaged changes.

[main bc677a4] New backup from 19-09-23
 1 file changed, 1 insertion(+), 1 deletion(-)

Stats 85328.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.33 cputime=83.608 memavail=680964 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Stats 85329.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7769 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003449  heater_bed: target=0 temp=26.0 pwm=0.000 sysload=0.33 cputime=83.675 memavail=686548 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85330.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.33 cputime=83.713 memavail=685652 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85331.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003435  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.38 cputime=83.751 memavail=683292 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85332.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8130 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003472  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.38 cputime=83.789 memavail=682392 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85333.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003462  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.38 cputime=83.827 memavail=682008 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85334.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003458  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.38 cputime=83.866 memavail=686292 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85335.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8478 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003465  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.38 cputime=83.906 memavail=686068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85336.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003467  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.35 cputime=83.948 memavail=686068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85337.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003466  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.35 cputime=83.990 memavail=686068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85338.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8839 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003470  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.35 cputime=84.031 memavail=686068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85339.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003473  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.35 cputime=84.073 memavail=686068 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85340.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003470  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.35 cputime=84.114 memavail=685564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85341.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9200 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003476  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.32 cputime=84.156 memavail=684808 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85342.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=26.0 pwm=0.000 sysload=0.32 cputime=84.198 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85343.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003479  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.32 cputime=84.239 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85344.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9548 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.32 cputime=84.281 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85345.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.32 cputime=84.322 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85346.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9788 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.30 cputime=84.364 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85347.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9924 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.30 cputime=84.406 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85348.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.0 pwm=0.000 sysload=0.30 cputime=84.447 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85349.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.30 cputime=84.488 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85350.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10272 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003479  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.30 cputime=84.531 memavail=684804 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85351.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003478  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.27 cputime=84.572 memavail=683544 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85352.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.27 cputime=84.614 memavail=683552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85353.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10633 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.27 cputime=84.657 memavail=683552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85354.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003479  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.27 cputime=84.698 memavail=683552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85355.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.27 cputime=84.740 memavail=683552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85356.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10981 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003479  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.25 cputime=84.782 memavail=683552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.8 pwm=0.000
Stats 85357.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.25 cputime=84.822 memavail=683104 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85358.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003476  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.25 cputime=84.864 memavail=683104 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85359.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11342 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003477  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.25 cputime=84.910 memavail=682208 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85360.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.25 cputime=84.953 memavail=681312 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85361.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=26.0 pwm=0.000 sysload=0.23 cputime=84.996 memavail=679184 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85362.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11703 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=25.9 pwm=0.000 sysload=0.23 cputime=85.040 memavail=679036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85363.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=26.1 pwm=0.000 sysload=0.23 cputime=85.083 memavail=679036 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85364.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.23 cputime=85.126 memavail=679040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85365.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12044 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=26.0 pwm=0.000 sysload=0.23 cputime=85.165 memavail=678816 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85472.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=6093 bytes_read=24705 bytes_retransmit=0 bytes_invalid=0 send_seq=409 receive_seq=409 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=25.9 pwm=0.000 sysload=0.11 cputime=89.526 memavail=683152 print_time=167.147 buffer_time=0.732 print_stall=0 extruder: target=0 temp=27.8 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946922120: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:25:38 2023 (1695165938.3 85474.7)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946926216: New connection
webhooks client 1946926216: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 85480.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1843 upcoming_bytes=138 freq=72003865  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.19 cputime=93.496 memavail=683348 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946926216
webhooks: registering remote method 'reboot_machine' for connection id: 1946926216
webhooks: registering remote method 'pause_job_queue' for connection id: 1946926216
webhooks: registering remote method 'start_job_queue' for connection id: 1946926216
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946926216
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946926216
webhooks: registering remote method 'timelapse_render' for connection id: 1946926216
Stats 85481.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5092 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=244 retransmit_seq=0 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=18 upcoming_bytes=0 freq=72003276  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.19 cputime=93.600 memavail=683104 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85482.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003688  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.25 cputime=93.670 memavail=682096 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85483.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5970 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003743  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.25 cputime=93.718 memavail=682100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85484.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003801  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.25 cputime=93.760 memavail=682100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85485.0: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000242 mcu_task_stddev=0.000442 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003653  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.25 cputime=93.799 memavail=681204 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85486.0: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000242 mcu_task_stddev=0.000442 bytes_write=5145 bytes_read=6335 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003667  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.25 cputime=93.837 memavail=680308 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 85487.0: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000242 mcu_task_stddev=0.000442 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003577  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.23 cputime=93.897 memavail=682648 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85488.0: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000242 mcu_task_stddev=0.000442 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003562  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.23 cputime=93.941 memavail=682424 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85489.0: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000242 mcu_task_stddev=0.000442 bytes_write=5163 bytes_read=6683 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003598  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.23 cputime=93.992 memavail=682424 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85490.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.23 cputime=94.046 memavail=682424 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85491.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.23 cputime=94.099 memavail=682424 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85492.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7044 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.21 cputime=94.152 memavail=682432 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85493.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.21 cputime=94.203 memavail=681760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85494.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.21 cputime=94.252 memavail=681760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85495.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7420 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.21 cputime=94.301 memavail=681760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85496.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.21 cputime=94.349 memavail=681760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Proceeding with filter-branch...


Stats 85497.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.36 cputime=94.400 memavail=681760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Cannot rewrite branches: You have unstaged changes.

[main f57ad52] New backup from 19-09-23
 1 file changed, 3 deletions(-)

remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Stats 85498.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7784 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003562  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.36 cputime=94.461 memavail=684560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85499.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003555  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.36 cputime=94.497 memavail=684560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85500.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.36 cputime=94.539 memavail=684560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85501.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8145 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.36 cputime=94.581 memavail=684560 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85502.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003528  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.41 cputime=94.622 memavail=683568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85503.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.41 cputime=94.664 memavail=683568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85504.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8493 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.41 cputime=94.709 memavail=683568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85505.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.41 cputime=94.750 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85506.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.41 cputime=94.793 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85507.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8854 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.37 cputime=94.834 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85508.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.37 cputime=94.874 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85509.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.37 cputime=94.915 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85510.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9215 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003513  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.37 cputime=94.957 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85511.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.37 cputime=94.999 memavail=683344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85512.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.34 cputime=95.040 memavail=682344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85513.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9563 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.34 cputime=95.080 memavail=682344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85514.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.34 cputime=95.122 memavail=682344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85515.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9788 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.34 cputime=95.161 memavail=681736 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85516.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9924 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.34 cputime=95.196 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85517.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.32 cputime=95.238 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85518.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.32 cputime=95.276 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85519.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10272 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.32 cputime=95.317 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85520.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.32 cputime=95.358 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85521.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.32 cputime=95.400 memavail=684576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85522.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10633 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003519  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.29 cputime=95.442 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85523.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.29 cputime=95.483 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85524.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.29 cputime=95.522 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85525.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10981 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.29 cputime=95.564 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85526.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.29 cputime=95.606 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85527.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.27 cputime=95.652 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85528.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11342 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.27 cputime=95.695 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85529.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.27 cputime=95.738 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85530.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.27 cputime=95.781 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85531.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11703 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.27 cputime=95.826 memavail=683600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85532.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.25 cputime=95.870 memavail=687684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85533.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=26.2 pwm=0.000 sysload=0.25 cputime=95.912 memavail=687684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85534.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12044 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.25 cputime=95.957 memavail=687684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Stats 85644.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=6144 bytes_read=25091 bytes_retransmit=0 bytes_invalid=0 send_seq=414 receive_seq=414 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.10 cputime=100.518 memavail=686388 print_time=169.518 buffer_time=0.081 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946926216: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:28:29 2023 (1695166109.1 85645.4)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1965478696: New connection
webhooks client 1965478696: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 85650.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2940 bytes_read=5462 bytes_retransmit=9 bytes_invalid=0 send_seq=203 receive_seq=200 retransmit_seq=2 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1581 upcoming_bytes=352 freq=71997345  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.17 cputime=104.415 memavail=685460 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1965478696
webhooks: registering remote method 'reboot_machine' for connection id: 1965478696
webhooks: registering remote method 'pause_job_queue' for connection id: 1965478696
webhooks: registering remote method 'start_job_queue' for connection id: 1965478696
webhooks: registering remote method 'timelapse_newframe' for connection id: 1965478696
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1965478696
webhooks: registering remote method 'timelapse_render' for connection id: 1965478696
Stats 85651.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5082 bytes_read=5733 bytes_retransmit=9 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72006588  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.17 cputime=104.528 memavail=685216 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85652.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003389  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.16 cputime=104.587 memavail=683984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85653.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5970 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003038  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.16 cputime=104.629 memavail=683764 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85654.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003190  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.16 cputime=104.668 memavail=682644 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 85655.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000253 mcu_task_stddev=0.000449 bytes_write=5158 bytes_read=6224 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004041  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.16 cputime=104.721 memavail=681440 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85656.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000253 mcu_task_stddev=0.000449 bytes_write=5178 bytes_read=6350 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003760  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.16 cputime=104.770 memavail=680520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85657.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000253 mcu_task_stddev=0.000449 bytes_write=5184 bytes_read=6471 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003807  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.14 cputime=104.816 memavail=679624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85658.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000253 mcu_task_stddev=0.000449 bytes_write=5190 bytes_read=6577 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003633  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.14 cputime=104.864 memavail=679496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85659.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000253 mcu_task_stddev=0.000449 bytes_write=5215 bytes_read=6708 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.14 cputime=104.919 memavail=679368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85660.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000018 bytes_write=5221 bytes_read=6842 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003459  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.14 cputime=104.974 memavail=679496 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85661.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000018 bytes_write=5227 bytes_read=6948 bytes_retransmit=9 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003421  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.14 cputime=105.028 memavail=679368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85662.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000018 bytes_write=5252 bytes_read=7079 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003405  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.13 cputime=105.083 memavail=683152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85663.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000018 bytes_write=5277 bytes_read=7210 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003390  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.13 cputime=105.138 memavail=682264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85664.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000018 bytes_write=5283 bytes_read=7316 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003377  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.13 cputime=105.192 memavail=681368 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Stats 85665.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000019 bytes_write=5303 bytes_read=7456 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003372  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.13 cputime=105.246 memavail=674144 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Stats 85666.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000019 bytes_write=5342 bytes_read=7592 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003355  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.13 cputime=105.323 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85667.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000019 bytes_write=5367 bytes_read=7708 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003367  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.12 cputime=105.361 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85668.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000019 bytes_write=5398 bytes_read=7855 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003386  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.12 cputime=105.401 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85669.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000019 bytes_write=5423 bytes_read=7986 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003391  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.12 cputime=105.444 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85670.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5467 bytes_read=8127 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003400  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.12 cputime=105.489 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85671.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5492 bytes_read=8258 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003402  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.12 cputime=105.534 memavail=680744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85672.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5517 bytes_read=8389 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003403  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.11 cputime=105.578 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85673.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5542 bytes_read=8505 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003408  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.11 cputime=105.622 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85674.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5567 bytes_read=8636 bytes_retransmit=9 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003414  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.11 cputime=105.666 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85675.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000025 bytes_write=5592 bytes_read=8767 bytes_retransmit=9 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003412  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.11 cputime=105.710 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85676.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=5617 bytes_read=8897 bytes_retransmit=9 bytes_invalid=0 send_seq=307 receive_seq=307 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003420  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.11 cputime=105.753 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85677.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=5623 bytes_read=9018 bytes_retransmit=9 bytes_invalid=0 send_seq=308 receive_seq=308 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003425  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.26 cputime=105.797 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85678.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=5648 bytes_read=9149 bytes_retransmit=9 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003432  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.26 cputime=105.841 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85679.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=5673 bytes_read=9265 bytes_retransmit=9 bytes_invalid=0 send_seq=314 receive_seq=314 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003438  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.26 cputime=105.886 memavail=679992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85680.7: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=5698 bytes_read=9396 bytes_retransmit=9 bytes_invalid=0 send_seq=317 receive_seq=317 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003442  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.26 cputime=105.930 memavail=679988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85681.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=5704 bytes_read=9531 bytes_retransmit=9 bytes_invalid=0 send_seq=318 receive_seq=318 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.26 cputime=105.973 memavail=679988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85682.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=5748 bytes_read=9657 bytes_retransmit=9 bytes_invalid=0 send_seq=323 receive_seq=323 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003445  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.32 cputime=106.017 memavail=679516 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.9 pwm=0.000
Stats 85683.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=5754 bytes_read=9778 bytes_retransmit=9 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.32 cputime=106.056 memavail=679392 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85684.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=5760 bytes_read=9899 bytes_retransmit=9 bytes_invalid=0 send_seq=325 receive_seq=325 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003444  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.32 cputime=106.096 memavail=679264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85685.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=5785 bytes_read=10015 bytes_retransmit=9 bytes_invalid=0 send_seq=328 receive_seq=328 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.32 cputime=106.135 memavail=679136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85686.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=5810 bytes_read=10159 bytes_retransmit=9 bytes_invalid=0 send_seq=331 receive_seq=331 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.32 cputime=106.176 memavail=683472 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85687.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=5816 bytes_read=10280 bytes_retransmit=9 bytes_invalid=0 send_seq=332 receive_seq=332 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.38 cputime=106.214 memavail=683024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85688.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=5841 bytes_read=10396 bytes_retransmit=9 bytes_invalid=0 send_seq=335 receive_seq=335 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.38 cputime=106.256 memavail=682520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85689.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=5847 bytes_read=10517 bytes_retransmit=9 bytes_invalid=0 send_seq=336 receive_seq=336 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.38 cputime=106.297 memavail=682520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85690.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=5853 bytes_read=10638 bytes_retransmit=9 bytes_invalid=0 send_seq=337 receive_seq=337 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003446  heater_bed: target=0 temp=26.3 pwm=0.000 sysload=0.38 cputime=106.338 memavail=682520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85691.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=5859 bytes_read=10757 bytes_retransmit=9 bytes_invalid=0 send_seq=338 receive_seq=338 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=26.7 pwm=0.000 sysload=0.38 cputime=106.379 memavail=682520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85692.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=5903 bytes_read=10898 bytes_retransmit=9 bytes_invalid=0 send_seq=343 receive_seq=343 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.35 cputime=106.421 memavail=681524 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85693.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=5928 bytes_read=11029 bytes_retransmit=9 bytes_invalid=0 send_seq=346 receive_seq=346 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003447  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.35 cputime=106.463 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85694.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=5934 bytes_read=11135 bytes_retransmit=9 bytes_invalid=0 send_seq=347 receive_seq=347 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003449  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.35 cputime=106.503 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85695.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=5940 bytes_read=11256 bytes_retransmit=9 bytes_invalid=0 send_seq=348 receive_seq=348 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003452  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.35 cputime=106.544 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85696.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=5960 bytes_read=11396 bytes_retransmit=9 bytes_invalid=0 send_seq=350 receive_seq=350 retransmit_seq=2 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003450  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.35 cputime=106.586 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85697.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=5985 bytes_read=11512 bytes_retransmit=9 bytes_invalid=0 send_seq=353 receive_seq=353 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003449  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.32 cputime=106.627 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85698.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=6010 bytes_read=11643 bytes_retransmit=9 bytes_invalid=0 send_seq=356 receive_seq=356 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003452  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.32 cputime=106.669 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85699.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=6035 bytes_read=11774 bytes_retransmit=9 bytes_invalid=0 send_seq=359 receive_seq=359 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003453  heater_bed: target=0 temp=26.6 pwm=0.000 sysload=0.32 cputime=106.711 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85700.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=6041 bytes_read=11880 bytes_retransmit=9 bytes_invalid=0 send_seq=360 receive_seq=360 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003453  heater_bed: target=0 temp=26.8 pwm=0.000 sysload=0.32 cputime=106.750 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.1 pwm=0.000
Stats 85701.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=6047 bytes_read=12015 bytes_retransmit=9 bytes_invalid=0 send_seq=361 receive_seq=361 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003456  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.32 cputime=106.790 memavail=681528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85702.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=6072 bytes_read=12146 bytes_retransmit=9 bytes_invalid=0 send_seq=364 receive_seq=364 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003457  heater_bed: target=0 temp=26.4 pwm=0.000 sysload=0.29 cputime=106.829 memavail=685504 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Stats 85703.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=6078 bytes_read=12252 bytes_retransmit=9 bytes_invalid=0 send_seq=365 receive_seq=365 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003460  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.29 cputime=106.869 memavail=685508 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.2 pwm=0.000
Stats 85704.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=6084 bytes_read=12367 bytes_retransmit=9 bytes_invalid=0 send_seq=366 receive_seq=366 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003459  heater_bed: target=0 temp=26.5 pwm=0.000 sysload=0.29 cputime=106.910 memavail=685508 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=28.0 pwm=0.000
Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Running Command {update_git_script}...:
Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

remote: Repository not found.

fatal: repository 'https://github.com/Scooby7274/SV06_Klipper.git/' not found

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data/'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 * [new branch]      main -> main

Command {update_git_script} finished

Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data/'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'
index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Stats 87413.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=19304 bytes_read=216036 bytes_retransmit=9 bytes_invalid=0 send_seq=2393 receive_seq=2393 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=177.473 memavail=676044 print_time=1768.961 buffer_time=0.859 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1965478696: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:57:59 2023 (1695167879.1 87415.4)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946840776: New connection
webhooks client 1946840776: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 87420.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1880 upcoming_bytes=101 freq=72009211  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.15 cputime=181.415 memavail=675588 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946840776
webhooks: registering remote method 'reboot_machine' for connection id: 1946840776
webhooks: registering remote method 'pause_job_queue' for connection id: 1946840776
webhooks: registering remote method 'start_job_queue' for connection id: 1946840776
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946840776
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946840776
webhooks: registering remote method 'timelapse_render' for connection id: 1946840776
Stats 87421.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5082 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72005104  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.15 cputime=181.500 memavail=675396 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87422.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004026  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.15 cputime=181.565 memavail=675148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87423.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5955 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003706  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.15 cputime=181.622 memavail=674900 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87424.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003796  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.15 cputime=181.665 memavail=674676 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87425.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004313  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.13 cputime=181.707 memavail=673924 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data/'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 87426.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5145 bytes_read=6320 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003959  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.13 cputime=181.774 memavail=673916 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87427.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003755  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.13 cputime=181.817 memavail=673468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87428.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003669  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.13 cputime=181.864 memavail=672796 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87429.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5163 bytes_read=6668 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003611  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.13 cputime=181.911 memavail=671900 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87430.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003572  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.12 cputime=181.966 memavail=671484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87431.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=182.019 memavail=671996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.5 pwm=0.000
Stats 87432.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7029 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=182.072 memavail=676924 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87433.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=182.118 memavail=676124 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87434.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003474  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=182.163 memavail=675228 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87435.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7390 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003467  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.11 cputime=182.210 memavail=673344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Stats 87436.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=182.269 memavail=672168 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Everything up-to-date

Command {update_git_script} finished

Stats 87437.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003559  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=182.347 memavail=678188 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87438.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7754 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.11 cputime=182.392 memavail=677292 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87439.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.11 cputime=182.437 memavail=676396 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87440.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.480 memavail=675248 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87441.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8115 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.519 memavail=674352 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87442.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.560 memavail=673456 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87443.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003511  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.599 memavail=673456 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87444.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8463 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.638 memavail=673456 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87445.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.677 memavail=676892 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87446.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003491  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.704 memavail=677640 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87447.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8824 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.10 cputime=182.737 memavail=676744 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87448.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=25.5 pwm=0.000 sysload=0.10 cputime=182.779 memavail=675624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87449.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003482  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.10 cputime=182.819 memavail=674952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87450.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9172 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.09 cputime=182.859 memavail=674952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87451.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003484  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.09 cputime=182.900 memavail=674952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87452.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003481  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.09 cputime=182.941 memavail=674952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87453.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9533 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003483  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.09 cputime=182.982 memavail=674728 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87454.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.09 cputime=183.023 memavail=674376 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87455.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9775 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=183.062 memavail=678516 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87456.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9894 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003488  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=183.103 memavail=677848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87457.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=183.148 memavail=677848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87458.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.08 cputime=183.190 memavail=677848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87459.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10242 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=183.233 memavail=677848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87460.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003493  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=183.278 memavail=677848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87461.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.07 cputime=183.319 memavail=677852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87462.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10618 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.07 cputime=183.361 memavail=677852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87463.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=183.403 memavail=677852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87464.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.07 cputime=183.445 memavail=677852 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87465.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10966 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=183.486 memavail=676604 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87466.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=183.528 memavail=676608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87467.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=183.570 memavail=676608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87468.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11327 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.07 cputime=183.612 memavail=676608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87469.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.07 cputime=183.655 memavail=676608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87470.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=183.698 memavail=676360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87471.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11688 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=183.741 memavail=676360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87472.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003510  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=183.784 memavail=676360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87473.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=183.826 memavail=676360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87474.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12031 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=183.868 memavail=676360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87483.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5493 bytes_read=13078 bytes_retransmit=0 bytes_invalid=0 send_seq=309 receive_seq=309 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.19 cputime=184.238 memavail=675608 print_time=68.843 buffer_time=0.567 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946840776: Disconnected
Restarting printer
Start printer at Tue Sep 19 19:59:09 2023 (1695167949.2 87485.5)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1964459464: New connection
webhooks client 1964459464: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 87490.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2993 bytes_read=5467 bytes_retransmit=0 bytes_invalid=0 send_seq=204 receive_seq=201 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=1747 upcoming_bytes=138 freq=72006080  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.16 cputime=188.131 memavail=674676 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1964459464
webhooks: registering remote method 'reboot_machine' for connection id: 1964459464
webhooks: registering remote method 'pause_job_queue' for connection id: 1964459464
webhooks: registering remote method 'start_job_queue' for connection id: 1964459464
webhooks: registering remote method 'timelapse_newframe' for connection id: 1964459464
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1964459464
webhooks: registering remote method 'timelapse_render' for connection id: 1964459464
Stats 87491.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5082 bytes_read=5718 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003289  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.16 cputime=188.221 memavail=674428 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 87492.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5131 bytes_read=5859 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003883  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.16 cputime=188.287 memavail=674428 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87493.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5137 bytes_read=5965 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003806  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.16 cputime=188.344 memavail=674436 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87494.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5143 bytes_read=6086 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003777  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.16 cputime=188.386 memavail=674212 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup: /home/Klipper/klipper-backup: Is a directory

Command {update_git_script} finished

Stats 87495.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5149 bytes_read=6224 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003778  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.15 cputime=188.479 memavail=672284 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87496.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5155 bytes_read=6330 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003738  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.15 cputime=188.516 memavail=672300 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87497.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5161 bytes_read=6451 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003657  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.15 cputime=188.555 memavail=672300 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87498.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5167 bytes_read=6572 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.15 cputime=188.595 memavail=671692 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87499.7: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5173 bytes_read=6678 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003609  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.15 cputime=188.635 memavail=672044 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87500.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5179 bytes_read=6812 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003565  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.14 cputime=188.676 memavail=671760 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87501.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5185 bytes_read=6933 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003584  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.14 cputime=188.715 memavail=671912 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87502.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5191 bytes_read=7039 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003559  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.14 cputime=188.756 memavail=671784 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87503.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5197 bytes_read=7175 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.14 cputime=188.796 memavail=672136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87504.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5203 bytes_read=7281 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003526  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.14 cputime=188.836 memavail=672144 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87505.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5209 bytes_read=7400 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.13 cputime=188.876 memavail=670912 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87506.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5215 bytes_read=7536 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.13 cputime=188.916 memavail=670812 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87507.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5221 bytes_read=7642 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003506  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.13 cputime=188.955 memavail=671132 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87508.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5233 bytes_read=7764 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.13 cputime=188.997 memavail=671004 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87509.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5239 bytes_read=7900 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.13 cputime=189.040 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87510.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5245 bytes_read=8006 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=189.083 memavail=670780 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup: /home/Klipper/klipper-backup: Is a directory

Command {update_git_script} finished

Stats 87511.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5251 bytes_read=8125 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003509  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=189.181 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87512.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5257 bytes_read=8261 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=189.225 memavail=670692 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87513.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5263 bytes_read=8367 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=189.265 memavail=670564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87514.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5269 bytes_read=8473 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.12 cputime=189.305 memavail=670660 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87515.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5275 bytes_read=8609 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=189.345 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87516.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5281 bytes_read=8728 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=189.375 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87517.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5287 bytes_read=8834 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=189.418 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87518.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5293 bytes_read=8970 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003508  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.11 cputime=189.464 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87519.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5299 bytes_read=9076 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.11 cputime=189.508 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87520.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5305 bytes_read=9182 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.10 cputime=189.546 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87521.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5311 bytes_read=9331 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.10 cputime=189.587 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87522.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5317 bytes_read=9437 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.10 cputime=189.629 memavail=674568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87523.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5323 bytes_read=9543 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.10 cputime=189.671 memavail=674572 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87524.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5329 bytes_read=9679 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.10 cputime=189.712 memavail=674572 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87525.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5335 bytes_read=9785 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.09 cputime=189.751 memavail=673564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87526.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5341 bytes_read=9904 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.09 cputime=189.789 memavail=673340 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87527.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5347 bytes_read=10040 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.09 cputime=189.831 memavail=673340 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87528.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5353 bytes_read=10146 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003494  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.09 cputime=189.876 memavail=673340 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87529.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5359 bytes_read=10252 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.09 cputime=189.921 memavail=672444 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87530.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5365 bytes_read=10388 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003498  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.08 cputime=189.965 memavail=671996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87531.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5371 bytes_read=10507 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=190.009 memavail=671996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87532.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5377 bytes_read=10613 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=190.048 memavail=671100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87533.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5383 bytes_read=10749 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003496  heater_bed: target=0 temp=25.4 pwm=0.000 sysload=0.08 cputime=190.088 memavail=670204 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87534.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5389 bytes_read=10855 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=190.127 memavail=669564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87535.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5395 bytes_read=10961 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=190.166 memavail=673208 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87536.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5401 bytes_read=11110 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.08 cputime=190.197 memavail=672312 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87537.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5407 bytes_read=11216 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.08 cputime=190.239 memavail=671416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87538.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5413 bytes_read=11322 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=190.277 memavail=670520 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87539.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5419 bytes_read=11458 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.08 cputime=190.317 memavail=669624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.3 pwm=0.000
Stats 87540.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5425 bytes_read=11564 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.07 cputime=190.355 memavail=668984 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87541.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5431 bytes_read=11683 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003500  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=190.395 memavail=673024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87542.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5437 bytes_read=11819 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=190.435 memavail=672800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Stats 87543.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5443 bytes_read=11925 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=25.3 pwm=0.000 sysload=0.07 cputime=190.474 memavail=672800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.4 pwm=0.000
Stats 87544.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5449 bytes_read=12027 bytes_retransmit=0 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=25.2 pwm=0.000 sysload=0.07 cputime=190.514 memavail=672800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=27.2 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup: /home/Klipper/klipper-backup: Is a directory

Command {update_git_script} finished

Running Command {update_git_script}...:
/home/Klipper/klipper-backup: /home/Klipper/klipper-backup: Is a directory

Command {update_git_script} finished

Stats 90099.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=24013 bytes_read=315918 bytes_retransmit=0 bytes_invalid=0 send_seq=3207 receive_seq=3207 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.02 cputime=294.991 memavail=676344 print_time=2614.110 buffer_time=0.015 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1964459464: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:42:44 2023 (1695170564.3 90100.7)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1966097888: New connection
webhooks client 1966097888: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 90105.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1843 upcoming_bytes=138 freq=72002976  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.02 cputime=298.881 memavail=676708 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1966097888
webhooks: registering remote method 'reboot_machine' for connection id: 1966097888
webhooks: registering remote method 'pause_job_queue' for connection id: 1966097888
webhooks: registering remote method 'start_job_queue' for connection id: 1966097888
webhooks: registering remote method 'timelapse_newframe' for connection id: 1966097888
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1966097888
webhooks: registering remote method 'timelapse_render' for connection id: 1966097888
Stats 90106.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5082 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003702  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=298.989 memavail=676236 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90107.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003440  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.038 memavail=676240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90108.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5955 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003649  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.089 memavail=676244 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90109.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003667  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.02 cputime=299.128 memavail=675072 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90110.9: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000264 mcu_task_stddev=0.000457 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003532  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.172 memavail=674404 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup: /home/Klipper/klipper-backup: Is a directory

Command {update_git_script} finished

Stats 90111.9: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000264 mcu_task_stddev=0.000457 bytes_write=5145 bytes_read=6320 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003455  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.273 memavail=673704 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90112.9: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000264 mcu_task_stddev=0.000457 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003420  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.306 memavail=672808 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90113.9: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000264 mcu_task_stddev=0.000457 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.345 memavail=672136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90114.9: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000264 mcu_task_stddev=0.000457 bytes_write=5163 bytes_read=6668 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003490  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.02 cputime=299.385 memavail=672232 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90115.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003486  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.432 memavail=672232 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90116.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.475 memavail=672232 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90117.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7029 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=23.5 pwm=0.000 sysload=0.01 cputime=299.513 memavail=672008 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90118.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.552 memavail=676264 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90119.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=299.590 memavail=673844 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90120.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7390 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.629 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90121.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.672 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90122.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003603  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=299.713 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90123.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7754 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003575  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.755 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90124.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003563  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.797 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90125.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=7996 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.839 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90126.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8115 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.879 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90127.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003607  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=299.923 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90128.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003593  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=299.965 memavail=672948 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90129.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8463 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003579  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.005 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90130.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8599 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003568  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.047 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90131.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.089 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90132.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8824 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.134 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90133.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003584  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.179 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90134.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003573  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.01 cputime=300.222 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90135.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9172 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003568  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.267 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90136.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.310 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90137.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003584  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.354 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90138.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9533 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003580  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.398 memavail=676416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90139.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003572  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.442 memavail=676172 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90140.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9775 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003568  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.487 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90141.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9894 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003563  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.530 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90142.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.575 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90143.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.616 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90144.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10242 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.659 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90145.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.705 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90146.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.750 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90147.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10603 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.794 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90148.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.837 memavail=676176 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90149.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=300.878 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90150.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10951 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=300.922 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90151.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=23.5 pwm=0.000 sysload=0.01 cputime=300.968 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90152.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=301.012 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90153.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11312 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.058 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90154.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003532  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.101 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90155.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.143 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90156.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11673 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.186 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90158.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.229 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90159.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.01 cputime=301.273 memavail=676180 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90160.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12031 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.01 cputime=301.315 memavail=675424 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90200.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5685 bytes_read=16773 bytes_retransmit=0 bytes_invalid=0 send_seq=341 receive_seq=341 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003521  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.00 cputime=302.898 memavail=673196 print_time=100.190 buffer_time=0.902 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1966097888: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:44:25 2023 (1695170665.7 90202.0)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946580712: New connection
webhooks client 1946580712: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 90207.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=2781 bytes_read=5447 bytes_retransmit=0 bytes_invalid=0 send_seq=200 receive_seq=197 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1419 upcoming_bytes=658 freq=72005532  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.00 cputime=306.819 memavail=672992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946580712
webhooks: registering remote method 'reboot_machine' for connection id: 1946580712
webhooks: registering remote method 'pause_job_queue' for connection id: 1946580712
webhooks: registering remote method 'start_job_queue' for connection id: 1946580712
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946580712
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946580712
webhooks: registering remote method 'timelapse_render' for connection id: 1946580712
Stats 90208.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5092 bytes_read=5718 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=7 upcoming_bytes=0 freq=72008037  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=306.931 memavail=673040 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 90209.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5131 bytes_read=5859 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004442  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=306.985 memavail=672816 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90210.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5137 bytes_read=5965 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004038  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.036 memavail=671376 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90211.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000033 bytes_write=5143 bytes_read=6086 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003782  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.078 memavail=670480 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Running Command {update_git_script}...:
cp: -r not specified; omitting directory '/home/Klipper/printer_data/'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 90212.3: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5149 bytes_read=6224 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003786  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.137 memavail=669540 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90213.3: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5155 bytes_read=6330 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003638  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=307.178 memavail=668868 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90214.3: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5161 bytes_read=6451 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003592  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.227 memavail=667972 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90215.3: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5167 bytes_read=6572 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.273 memavail=667556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90216.3: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000263 mcu_task_stddev=0.000457 bytes_write=5173 bytes_read=6678 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.00 cputime=307.320 memavail=667684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90217.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5179 bytes_read=6812 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=307.370 memavail=667556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90218.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5185 bytes_read=6933 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003502  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.418 memavail=671608 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90219.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5191 bytes_read=7039 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003512  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=307.466 memavail=670488 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90220.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5197 bytes_read=7175 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003507  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.512 memavail=669004 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90221.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5203 bytes_read=7281 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003513  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.557 memavail=668556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

Stats 90222.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5209 bytes_read=7400 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.00 cputime=307.613 memavail=663836 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
On branch main
nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Stats 90223.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5215 bytes_read=7536 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.660 memavail=672284 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90224.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5221 bytes_read=7642 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.698 memavail=676896 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90225.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5233 bytes_read=7764 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003615  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.737 memavail=676896 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90226.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5239 bytes_read=7900 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003597  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.775 memavail=676896 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90227.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5245 bytes_read=8006 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003585  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=307.813 memavail=676896 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90228.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5251 bytes_read=8125 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003648  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.852 memavail=676644 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90229.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5257 bytes_read=8261 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003627  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.891 memavail=676644 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90230.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5263 bytes_read=8367 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003609  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.929 memavail=676160 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90231.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5269 bytes_read=8473 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003595  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=307.970 memavail=675712 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90232.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5275 bytes_read=8609 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.010 memavail=674816 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90233.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5281 bytes_read=8728 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003578  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.052 memavail=673920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90234.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5287 bytes_read=8834 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003567  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.092 memavail=673024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90235.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5293 bytes_read=8970 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003600  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.131 memavail=672672 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90236.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5299 bytes_read=9076 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003588  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.168 memavail=672768 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90237.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5305 bytes_read=9182 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003579  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.207 memavail=672864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90238.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5311 bytes_read=9331 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003573  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.248 memavail=672864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90239.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5317 bytes_read=9437 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003565  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.289 memavail=672864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90240.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5323 bytes_read=9543 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.320 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90241.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5329 bytes_read=9679 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.362 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90242.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5335 bytes_read=9785 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.403 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90243.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5341 bytes_read=9904 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.442 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90244.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5347 bytes_read=10040 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.483 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90245.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5353 bytes_read=10146 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.524 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90246.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5359 bytes_read=10252 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.565 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90247.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5365 bytes_read=10388 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.605 memavail=671108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90248.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5371 bytes_read=10507 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.645 memavail=671112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90249.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5377 bytes_read=10613 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.683 memavail=671112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90250.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5383 bytes_read=10749 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=308.724 memavail=670136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90251.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5389 bytes_read=10855 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.765 memavail=670136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90252.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5395 bytes_read=10961 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.807 memavail=670136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90253.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5401 bytes_read=11110 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.00 cputime=308.848 memavail=670136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90254.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5407 bytes_read=11216 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.00 cputime=308.886 memavail=669724 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90255.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5413 bytes_read=11322 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.927 memavail=669756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90256.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5419 bytes_read=11458 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=308.969 memavail=669756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90257.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5425 bytes_read=11564 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=309.011 memavail=669756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90258.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5431 bytes_read=11683 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.003 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.00 cputime=309.051 memavail=669756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90259.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5437 bytes_read=11819 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=309.092 memavail=669756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90260.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5443 bytes_read=11925 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.00 cputime=309.131 memavail=669000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90261.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5449 bytes_read=12027 bytes_retransmit=0 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003534  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.08 cputime=309.172 memavail=669000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Running Command {update_git_script}...:
cp: -r not specified; omitting directory '/home/Klipper/printer_data'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Everything up-to-date

Command {update_git_script} finished

Stats 90430.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=6481 bytes_read=32072 bytes_retransmit=0 bytes_invalid=0 send_seq=474 receive_seq=474 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003516  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.25 cputime=316.232 memavail=672688 print_time=229.325 buffer_time=0.849 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946580712: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:48:16 2023 (1695170896.2 90432.6)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1970312984: New connection
webhooks client 1970312984: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 90437.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=2887 bytes_read=5457 bytes_retransmit=9 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=2 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1814 upcoming_bytes=167 freq=72005447  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.22 cputime=320.176 memavail=672480 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1970312984
webhooks: registering remote method 'reboot_machine' for connection id: 1970312984
webhooks: registering remote method 'pause_job_queue' for connection id: 1970312984
webhooks: registering remote method 'start_job_queue' for connection id: 1970312984
webhooks: registering remote method 'timelapse_newframe' for connection id: 1970312984
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1970312984
webhooks: registering remote method 'timelapse_render' for connection id: 1970312984
Stats 90438.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5082 bytes_read=5733 bytes_retransmit=9 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=2 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004300  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.22 cputime=320.293 memavail=671564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90439.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5121 bytes_read=5849 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003842  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.22 cputime=320.354 memavail=670360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90440.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5127 bytes_read=5970 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003625  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=320.389 memavail=669464 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/printer_data/klipper-backup/script.sh: No such file or directory

Command {update_git_script} finished

Stats 90441.9: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5133 bytes_read=6091 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003744  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.20 cputime=320.473 memavail=668996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90442.9: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5139 bytes_read=6214 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003616  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.20 cputime=320.506 memavail=668100 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90443.9: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5145 bytes_read=6335 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003665  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.20 cputime=320.545 memavail=667460 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90444.9: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5151 bytes_read=6456 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003630  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.20 cputime=320.582 memavail=667556 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90445.9: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5157 bytes_read=6562 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003612  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.20 cputime=320.621 memavail=667684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90446.9: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5163 bytes_read=6698 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003598  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=320.667 memavail=667684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90447.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003823  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.18 cputime=320.705 memavail=667684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90448.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003753  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=320.733 memavail=667684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90449.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7059 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003699  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=320.779 memavail=671572 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90450.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003882  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=320.824 memavail=670680 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90451.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003857  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=320.868 memavail=669784 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90452.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7420 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003903  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=320.916 memavail=668888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90453.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7526 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003840  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.17 cputime=320.962 memavail=667992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90454.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5217 bytes_read=7648 bytes_retransmit=9 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003728  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=321.001 memavail=668120 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90455.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7784 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003738  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=321.041 memavail=667992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90456.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003706  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=321.079 memavail=672256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90457.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003674  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.15 cputime=321.119 memavail=671360 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90458.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8145 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003648  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.15 cputime=321.158 memavail=670240 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90459.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003626  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=321.197 memavail=673300 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90460.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003611  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=321.233 memavail=672860 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90461.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8493 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003599  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.14 cputime=321.277 memavail=672860 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90462.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003592  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.14 cputime=321.320 memavail=672860 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90463.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.14 cputime=321.364 memavail=670644 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90464.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8854 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003567  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.14 cputime=321.390 memavail=674112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90465.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003565  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.14 cputime=321.436 memavail=674112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90466.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.13 cputime=321.479 memavail=674112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90467.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9215 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.13 cputime=321.526 memavail=674112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90468.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.13 cputime=321.568 memavail=674112 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90469.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.13 cputime=321.608 memavail=673356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90470.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9563 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.13 cputime=321.649 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90471.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.12 cputime=321.690 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90472.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9788 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.12 cputime=321.734 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90473.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9924 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.12 cputime=321.780 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90474.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.12 cputime=321.824 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90475.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.12 cputime=321.868 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90476.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10272 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.11 cputime=321.913 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90477.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.11 cputime=321.957 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90478.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.11 cputime=322.001 memavail=673364 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90479.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10633 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003535  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.11 cputime=322.045 memavail=678376 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90480.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.11 cputime=322.089 memavail=678156 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90481.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.10 cputime=322.134 memavail=678156 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90482.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10981 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.10 cputime=322.176 memavail=678156 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90483.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.10 cputime=322.217 memavail=678156 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90484.9: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.10 cputime=322.257 memavail=677932 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90486.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11342 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.10 cputime=322.297 memavail=677260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90487.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.09 cputime=322.339 memavail=677260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90488.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11569 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.09 cputime=322.383 memavail=677260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90489.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11703 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.09 cputime=322.426 memavail=677260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90490.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.09 cputime=322.468 memavail=677008 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90491.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11930 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.09 cputime=322.509 memavail=676768 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90492.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12044 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.08 cputime=322.552 memavail=676768 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90516.0: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5589 bytes_read=14888 bytes_retransmit=9 bytes_invalid=0 send_seq=325 receive_seq=325 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.27 cputime=323.552 memavail=676004 print_time=84.076 buffer_time=0.692 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1970312984: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:49:41 2023 (1695170981.5 90517.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/printer_data/klipper-backup-main/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1963823696: New connection
webhooks client 1963823696: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Stats 90523.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=3049 bytes_read=5497 bytes_retransmit=9 bytes_invalid=0 send_seq=205 receive_seq=202 retransmit_seq=2 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=1609 upcoming_bytes=228 freq=72005927  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.23 cputime=327.422 memavail=675568 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1963823696
webhooks: registering remote method 'reboot_machine' for connection id: 1963823696
webhooks: registering remote method 'pause_job_queue' for connection id: 1963823696
webhooks: registering remote method 'start_job_queue' for connection id: 1963823696
webhooks: registering remote method 'timelapse_newframe' for connection id: 1963823696
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1963823696
webhooks: registering remote method 'timelapse_render' for connection id: 1963823696
Stats 90524.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5077 bytes_read=5758 bytes_retransmit=9 bytes_invalid=0 send_seq=243 receive_seq=243 retransmit_seq=2 srtt=0.005 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.23 cputime=327.519 memavail=675072 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 90525.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5105 bytes_read=5889 bytes_retransmit=9 bytes_invalid=0 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003774  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.23 cputime=327.590 memavail=675076 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 90526.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5111 bytes_read=6010 bytes_retransmit=9 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003650  heater_bed: target=0 temp=24.1 pwm=0.000 sysload=0.23 cputime=327.653 memavail=674856 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90527.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000033 bytes_write=5117 bytes_read=6116 bytes_retransmit=9 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003895  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.29 cputime=327.695 memavail=674632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Running Command {update_git_script}...:
cp: cannot copy a directory, '/home/Klipper/printer_data/', into itself, '/home/Klipper/printer_data/klipper-backup-main/Sovol_KlipperPI3/printer_data'

cp: cannot copy a directory, '/home/Klipper/printer_data/', into itself, '/home/Klipper/printer_data/klipper-backup-main/Sovol_KlipperPI3/printer_data/printer_data'

Reinitialized existing Git repository in /home/Klipper/printer_data/klipper-backup-main/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 90528.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000464 bytes_write=5123 bytes_read=6254 bytes_retransmit=9 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003678  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.29 cputime=327.775 memavail=674416 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90529.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000464 bytes_write=5129 bytes_read=6375 bytes_retransmit=9 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003643  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.29 cputime=327.817 memavail=674452 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90530.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000464 bytes_write=5135 bytes_read=6481 bytes_retransmit=9 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003599  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.29 cputime=327.864 memavail=672820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90531.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000464 bytes_write=5141 bytes_read=6602 bytes_retransmit=9 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.29 cputime=327.897 memavail=672828 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90532.1: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000269 mcu_task_stddev=0.000464 bytes_write=5147 bytes_read=6723 bytes_retransmit=9 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003478  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.51 cputime=327.935 memavail=672840 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90533.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5153 bytes_read=6842 bytes_retransmit=9 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003492  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.51 cputime=327.982 memavail=672840 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90534.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5159 bytes_read=6963 bytes_retransmit=9 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003518  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.51 cputime=328.029 memavail=672840 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90535.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5165 bytes_read=7084 bytes_retransmit=9 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003517  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.51 cputime=328.074 memavail=672840 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90536.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5171 bytes_read=7205 bytes_retransmit=9 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.51 cputime=328.122 memavail=672168 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90537.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5177 bytes_read=7311 bytes_retransmit=9 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.71 cputime=328.169 memavail=671528 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Proceeding with filter-branch...


Stats 90538.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5183 bytes_read=7445 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.71 cputime=328.219 memavail=671168 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Rewrite 65b48be32ed3d120c90bc2afb890831ed7f7b91b (1/39) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/printer_data/klipper-backup-main/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

warning: adding embedded git repository: Sovol_KlipperPI3/printer_data/klipper-backup-main
hint: You've added another git repository inside your current repository.
hint: Clones of the outer repository will not contain the contents of
hint: the embedded repository and will not know how to obtain it.
hint: If you meant to add a submodule, use:
hint: 
hint: 	git submodule add <url> Sovol_KlipperPI3/printer_data/klipper-backup-main
hint: 
hint: If you added this path by mistake, you can remove it from the
hint: index with:
hint: 
hint: 	git rm --cached Sovol_KlipperPI3/printer_data/klipper-backup-main

hint: 
hint: See "git help submodule" for more information.

Stats 90539.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5189 bytes_read=7566 bytes_retransmit=9 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.71 cputime=328.267 memavail=670272 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
warning: adding embedded git repository: Sovol_KlipperPI3/printer_data/printer_data/klipper-backup-main

Stats 90540.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5201 bytes_read=7688 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.71 cputime=328.304 memavail=669996 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90541.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5207 bytes_read=7809 bytes_retransmit=9 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003580  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.71 cputime=328.338 memavail=669848 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90542.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5213 bytes_read=7930 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003574  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.05 cputime=328.390 memavail=669976 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90543.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5219 bytes_read=8049 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003566  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.05 cputime=328.437 memavail=669752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90544.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5225 bytes_read=8170 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.05 cputime=328.484 memavail=669752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90545.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5231 bytes_read=8291 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.05 cputime=328.534 memavail=667484 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
[main 1d948d1] New backup from 19-09-23
 108 files changed, 562410 insertions(+)
 create mode 100644 Sovol_KlipperPI3/printer_data/.moonraker.uuid
 create mode 100644 Sovol_KlipperPI3/printer_data/backup/20230714T021326Z/config/moonraker.conf
 create mode 120000 Sovol_KlipperPI3/printer_data/comms/klippy.serial
 create mode 100644 Sovol_KlipperPI3/printer_data/config/.moonraker.conf.bkp
 create mode 100644 Sovol_KlipperPI3/printer_data/config/ADXL_SHAPER.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/Adaptive_Meshing.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/CALIBRATION.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/KAMP
 create mode 100644 Sovol_KlipperPI3/printer_data/config/KAMP_Settings.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/Line_Purge.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/MECHANICAL_GANTRY_CALIBRATION.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/PARKING.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/Smart_Park.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/adxl-direct.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/config_backup.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/crowsnest.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/config/macros.cfg
 create mode 120000 Sovol_KlipperPI3/printer_data/config/mainsail.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/mainsail1.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/misc-macros.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/moonraker.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/config/octoeverywhere-system.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/octoeverywhere.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/config/printer-20230918_194815.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/printer.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/shell_command.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/config/sonar.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/config/test.cfg
 create mode 120000 Sovol_KlipperPI3/printer_data/config/timelapse.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/database/data.mdb
 create mode 100644 Sovol_KlipperPI3/printer_data/database/lock.mdb
 create mode 160000 Sovol_KlipperPI3/printer_data/klipper-backup-main
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/crowsnest.log
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/crowsnest.log.2023-09-19
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/klippy.log
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/klippy.log.2023-05-13
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/klippy.log.2023-09-17
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/klippy.log.2023-09-18
 create mode 120000 Sovol_KlipperPI3/printer_data/logs/mainsail-access.log
 create mode 120000 Sovol_KlipperPI3/printer_data/logs/mainsail-error.log
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/moonraker.log
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/moonraker.log.2023-09-18
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/octoeverywhere.log
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/octoeverywhere.log.1
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/octoeverywhere.log.2
 create mode 100644 Sovol_KlipperPI3/printer_data/logs/octoeverywhere.log.3
 create mode 120000 Sovol_KlipperPI3/printer_data/logs/sonar.log
 create mode 100644 Sovol_KlipperPI3/printer_data/moonraker.asvc
 create mode 100644 Sovol_KlipperPI3/printer_data/octoeverywhere-store/PingPongDataV2.json
 create mode 100644 Sovol_KlipperPI3/printer_data/octoeverywhere-store/mDnsCache.json
 create mode 100644 Sovol_KlipperPI3/printer_data/octoeverywhere-store/octoeverywhere.secrets
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/.moonraker.uuid
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/backup/20230714T021326Z/config/moonraker.conf

 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/comms/klippy.serial
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/.moonraker.conf.bkp
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/ADXL_SHAPER.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/Adaptive_Meshing.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/CALIBRATION.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/KAMP
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/KAMP_Settings.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/Line_Purge.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/MECHANICAL_GANTRY_CALIBRATION.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/PARKING.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/Smart_Park.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/adxl-direct.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/config_backup.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/crowsnest.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/macros.cfg
 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/config/mainsail.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/mainsail1.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/misc-macros.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/moonraker.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/octoeverywhere-system.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/octoeverywhere.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/printer-20230918_194815.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/printer.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/shell_command.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/sonar.conf
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/config/test.cfg
 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/config/timelapse.cfg
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/database/data.mdb
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/database/lock.mdb
 create mode 160000 Sovol_KlipperPI3/printer_data/printer_data/klipper-backup-main
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/crowsnest.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/crowsnest.log.2023-09-19
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/klippy.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/klippy.log.2023-05-13
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/klippy.log.2023-09-17
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/klippy.log.2023-09-18
 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/logs/mainsail-access.log
 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/logs/mainsail-error.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/moonraker.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/moonraker.log.2023-09-18
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/octoeverywhere.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/octoeverywhere.log.1
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/octoeverywhere.log.2
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/logs/octoeverywhere.log.3
 create mode 120000 Sovol_KlipperPI3/printer_data/printer_data/logs/sonar.log
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/moonraker.asvc
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/octoeverywhere-store/PingPongDataV2.json

Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/octoeverywhere-store/mDnsCache.json
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/octoeverywhere-store/octoeverywhere.secrets
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/systemd/crowsnest.env
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/systemd/klipper.env
 create mode 100644 Sovol_KlipperPI3/printer_data/printer_data/systemd/moonraker.env
 create mode 100644 Sovol_KlipperPI3/printer_data/systemd/crowsnest.env
 create mode 100644 Sovol_KlipperPI3/printer_data/systemd/klipper.env
 create mode 100644 Sovol_KlipperPI3/printer_data/systemd/moonraker.env

Stats 90546.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5237 bytes_read=8397 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.05 cputime=328.579 memavail=665828 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
To https://github.com/Scooby7274/Sovol_KlipperPI3.git
 ! [rejected]        main -> main (fetch first)

error: failed to push some refs to 'https://github.com/Scooby7274/Sovol_KlipperPI3.git'

hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.

Command {update_git_script} finished

Stats 90547.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5243 bytes_read=8518 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.97 cputime=328.634 memavail=671800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90548.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5249 bytes_read=8652 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.97 cputime=328.676 memavail=672088 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90549.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5255 bytes_read=8758 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.97 cputime=328.715 memavail=671928 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90550.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5261 bytes_read=8879 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.97 cputime=328.755 memavail=675276 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 90551.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5267 bytes_read=9000 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003567  heater_bed: target=0 temp=24.1 pwm=0.000 sysload=0.97 cputime=328.794 memavail=674624 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90552.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5273 bytes_read=9106 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.89 cputime=328.833 memavail=673952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90553.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5279 bytes_read=9227 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003563  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.89 cputime=328.874 memavail=673952 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90554.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5285 bytes_read=9361 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.89 cputime=328.913 memavail=673056 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90555.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5291 bytes_read=9467 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.89 cputime=328.951 memavail=672160 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90556.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5297 bytes_read=9588 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003561  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.89 cputime=328.991 memavail=672032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90557.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5303 bytes_read=9709 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.82 cputime=329.029 memavail=671680 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90558.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5309 bytes_read=9815 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.82 cputime=329.068 memavail=672032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90559.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5315 bytes_read=9949 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.82 cputime=329.107 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90560.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5321 bytes_read=10070 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.82 cputime=329.148 memavail=670992 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90561.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5327 bytes_read=10176 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.82 cputime=329.188 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90562.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5333 bytes_read=10297 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003553  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.75 cputime=329.230 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90563.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5339 bytes_read=10418 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.75 cputime=329.269 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90564.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5345 bytes_read=10537 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.75 cputime=329.308 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90565.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5351 bytes_read=10658 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.75 cputime=329.347 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 90566.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5357 bytes_read=10779 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.75 cputime=329.385 memavail=670584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90567.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5363 bytes_read=10885 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.85 cputime=329.424 memavail=670936 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90568.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5369 bytes_read=11006 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.85 cputime=329.465 memavail=670552 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90569.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5375 bytes_read=11140 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.85 cputime=329.505 memavail=670648 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90570.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5381 bytes_read=11246 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.85 cputime=329.544 memavail=670396 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90571.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5387 bytes_read=11367 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003547  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.85 cputime=329.588 memavail=670500 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90572.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5393 bytes_read=11488 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003547  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.86 cputime=329.627 memavail=670372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90573.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5399 bytes_read=11594 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=24.0 pwm=0.000 sysload=0.86 cputime=329.671 memavail=670500 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90574.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5405 bytes_read=11728 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003549  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.86 cputime=329.714 memavail=670372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90575.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5411 bytes_read=11849 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.86 cputime=329.742 memavail=670244 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Unknown command:"GIT"
Stats 90576.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5417 bytes_read=11955 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.86 cputime=329.783 memavail=670564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90577.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5423 bytes_read=12071 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003552  heater_bed: target=0 temp=24.1 pwm=0.000 sysload=0.79 cputime=329.825 memavail=670372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Unknown command:"GIT"
Stats 90617.1: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5669 bytes_read=16814 bytes_retransmit=9 bytes_invalid=0 send_seq=340 receive_seq=340 retransmit_seq=2 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.49 cputime=331.477 memavail=676076 print_time=100.156 buffer_time=0.876 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1963823696: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:51:22 2023 (1695171082.9 90619.2)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup-main/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1965919440: New connection
webhooks client 1965919440: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 90624.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=2887 bytes_read=5457 bytes_retransmit=0 bytes_invalid=0 send_seq=202 receive_seq=199 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=1859 upcoming_bytes=122 freq=72005540  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.53 cputime=335.410 memavail=674504 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1965919440
webhooks: registering remote method 'reboot_machine' for connection id: 1965919440
webhooks: registering remote method 'pause_job_queue' for connection id: 1965919440
webhooks: registering remote method 'start_job_queue' for connection id: 1965919440
webhooks: registering remote method 'timelapse_newframe' for connection id: 1965919440
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1965919440
webhooks: registering remote method 'timelapse_render' for connection id: 1965919440
Stats 90625.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5082 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=244 receive_seq=244 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004620  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.53 cputime=335.520 memavail=674032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90626.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003098  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.53 cputime=335.567 memavail=674032 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90627.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5127 bytes_read=5955 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003283  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=335.617 memavail=673564 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90628.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000034 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003335  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.49 cputime=335.658 memavail=673344 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup-main/script.sh: No such file or directory

Command {update_git_script} finished

Stats 90629.4: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000265 mcu_task_stddev=0.000457 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003324  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=335.758 memavail=673092 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90630.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000265 mcu_task_stddev=0.000457 bytes_write=5145 bytes_read=6320 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003388  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=335.800 memavail=672588 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90631.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000265 mcu_task_stddev=0.000457 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003424  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.49 cputime=335.840 memavail=672588 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90632.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000265 mcu_task_stddev=0.000457 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003458  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.45 cputime=335.882 memavail=671468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 90633.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000265 mcu_task_stddev=0.000457 bytes_write=5163 bytes_read=6668 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003443  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.45 cputime=335.923 memavail=671244 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90634.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003435  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.45 cputime=335.963 memavail=670348 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90635.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003434  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.45 cputime=336.001 memavail=674204 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90636.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7029 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003438  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.45 cputime=336.040 memavail=673308 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90637.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003448  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.41 cputime=336.079 memavail=672412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90638.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003472  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.41 cputime=336.118 memavail=671488 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 90639.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7390 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003472  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.41 cputime=336.157 memavail=670592 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90640.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003469  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.41 cputime=336.196 memavail=673684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90641.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5211 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003476  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.41 cputime=336.235 memavail=673944 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90642.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7754 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003501  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.38 cputime=336.278 memavail=673944 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90643.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003497  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=336.320 memavail=673944 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90644.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=7996 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.38 cputime=336.361 memavail=673944 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90645.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8115 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003499  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.38 cputime=336.403 memavail=673752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90646.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003503  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=336.444 memavail=673752 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90647.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003505  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=336.486 memavail=673592 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90648.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8463 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003504  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=336.525 memavail=677384 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90649.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8599 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003514  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.35 cputime=336.567 memavail=677384 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 90650.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003510  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=336.607 memavail=676124 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90651.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8824 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=336.649 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90652.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=336.691 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90653.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=336.731 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90654.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9172 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003527  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=336.775 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90655.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=336.818 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90656.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=336.861 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90657.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9533 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.29 cputime=336.903 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90658.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=336.946 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90659.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9775 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=336.988 memavail=676128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90660.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9894 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=337.030 memavail=675880 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 90661.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.29 cputime=337.073 memavail=675884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90662.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=337.114 memavail=675884 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90663.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5382 bytes_read=10252 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=337.151 memavail=675884 print_time=44.458 buffer_time=0.203 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1965919440: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:52:08 2023 (1695171128.5 90664.8)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup-main
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946505544: New connection
webhooks client 1946505544: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 90670.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000035 bytes_write=2887 bytes_read=5457 bytes_retransmit=18 bytes_invalid=7 send_seq=202 receive_seq=199 retransmit_seq=2 srtt=0.005 rttvar=0.003 rto=0.025 ready_bytes=1981 upcoming_bytes=0 freq=72005666  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.33 cputime=341.071 memavail=675932 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946505544
webhooks: registering remote method 'reboot_machine' for connection id: 1946505544
webhooks: registering remote method 'pause_job_queue' for connection id: 1946505544
webhooks: registering remote method 'start_job_queue' for connection id: 1946505544
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946505544
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946505544
webhooks: registering remote method 'timelapse_render' for connection id: 1946505544
Stats 90671.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000035 bytes_write=5082 bytes_read=5733 bytes_retransmit=18 bytes_invalid=7 send_seq=244 receive_seq=244 retransmit_seq=2 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=23 freq=72009376  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.33 cputime=341.201 memavail=675692 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90672.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000035 bytes_write=5116 bytes_read=5844 bytes_retransmit=18 bytes_invalid=7 send_seq=246 receive_seq=246 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72006201  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=341.276 memavail=675468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90673.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000035 bytes_write=5122 bytes_read=5980 bytes_retransmit=18 bytes_invalid=7 send_seq=247 receive_seq=247 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004733  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=341.321 memavail=675468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90674.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000035 bytes_write=5128 bytes_read=6086 bytes_retransmit=18 bytes_invalid=7 send_seq=248 receive_seq=248 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004087  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=341.360 memavail=675468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Running Command {update_git_script}...:
bash: /home/Klipper/klipper-backup-main: No such file or directory

Command {update_git_script} finished

Stats 90675.2: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5134 bytes_read=6209 bytes_retransmit=18 bytes_invalid=7 send_seq=249 receive_seq=249 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003830  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.38 cputime=341.460 memavail=675468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90676.2: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5140 bytes_read=6345 bytes_retransmit=18 bytes_invalid=7 send_seq=250 receive_seq=250 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003782  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.38 cputime=341.504 memavail=675476 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90677.2: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5146 bytes_read=6451 bytes_retransmit=18 bytes_invalid=7 send_seq=251 receive_seq=251 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003819  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=341.549 memavail=674580 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90678.2: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5152 bytes_read=6557 bytes_retransmit=18 bytes_invalid=7 send_seq=252 receive_seq=252 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003839  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=341.596 memavail=673684 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90679.2: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000245 mcu_task_stddev=0.000444 bytes_write=5158 bytes_read=6693 bytes_retransmit=18 bytes_invalid=7 send_seq=253 receive_seq=253 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003761  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.35 cputime=341.634 memavail=673012 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90680.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5164 bytes_read=6812 bytes_retransmit=18 bytes_invalid=7 send_seq=254 receive_seq=254 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003745  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.35 cputime=341.681 memavail=672372 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90681.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5170 bytes_read=6918 bytes_retransmit=18 bytes_invalid=7 send_seq=255 receive_seq=255 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003735  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.35 cputime=341.727 memavail=676632 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90682.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5176 bytes_read=7054 bytes_retransmit=18 bytes_invalid=7 send_seq=256 receive_seq=256 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003667  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=341.775 memavail=675260 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90683.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5182 bytes_read=7160 bytes_retransmit=18 bytes_invalid=7 send_seq=257 receive_seq=257 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003638  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.32 cputime=341.814 memavail=674140 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90684.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5188 bytes_read=7266 bytes_retransmit=18 bytes_invalid=7 send_seq=258 receive_seq=258 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003626  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.32 cputime=341.852 memavail=673468 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90685.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5194 bytes_read=7415 bytes_retransmit=18 bytes_invalid=7 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003612  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.32 cputime=341.894 memavail=672324 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90686.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5200 bytes_read=7521 bytes_retransmit=18 bytes_invalid=7 send_seq=260 receive_seq=260 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003613  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.32 cputime=341.935 memavail=671428 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90687.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5206 bytes_read=7627 bytes_retransmit=18 bytes_invalid=7 send_seq=261 receive_seq=261 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003596  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.30 cputime=341.975 memavail=671300 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90688.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5218 bytes_read=7779 bytes_retransmit=18 bytes_invalid=7 send_seq=263 receive_seq=263 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003575  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.30 cputime=342.018 memavail=675864 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90689.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5224 bytes_read=7885 bytes_retransmit=18 bytes_invalid=7 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003655  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.30 cputime=342.058 memavail=674716 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90690.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5230 bytes_read=8004 bytes_retransmit=18 bytes_invalid=7 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003648  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.30 cputime=342.098 memavail=673820 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90691.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5236 bytes_read=8140 bytes_retransmit=18 bytes_invalid=7 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003627  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.30 cputime=342.149 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90692.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5242 bytes_read=8246 bytes_retransmit=18 bytes_invalid=7 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003614  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=342.191 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90693.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5248 bytes_read=8352 bytes_retransmit=18 bytes_invalid=7 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003604  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=342.226 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90694.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5254 bytes_read=8488 bytes_retransmit=18 bytes_invalid=7 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003603  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=342.275 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90695.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5260 bytes_read=8607 bytes_retransmit=18 bytes_invalid=7 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003644  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=342.319 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90696.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5266 bytes_read=8713 bytes_retransmit=18 bytes_invalid=7 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003633  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=342.361 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90697.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5272 bytes_read=8849 bytes_retransmit=18 bytes_invalid=7 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003636  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.33 cputime=342.406 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90698.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5278 bytes_read=8955 bytes_retransmit=18 bytes_invalid=7 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003620  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.33 cputime=342.457 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90699.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5284 bytes_read=9076 bytes_retransmit=18 bytes_invalid=7 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003608  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.33 cputime=342.499 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90700.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5290 bytes_read=9210 bytes_retransmit=18 bytes_invalid=7 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003600  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.33 cputime=342.543 memavail=672584 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90701.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5296 bytes_read=9316 bytes_retransmit=18 bytes_invalid=7 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003594  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.33 cputime=342.586 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90702.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5302 bytes_read=9437 bytes_retransmit=18 bytes_invalid=7 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003586  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.30 cputime=342.630 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90703.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5308 bytes_read=9558 bytes_retransmit=18 bytes_invalid=7 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003581  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.30 cputime=342.674 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90704.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5314 bytes_read=9664 bytes_retransmit=18 bytes_invalid=7 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003574  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.30 cputime=342.716 memavail=672336 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90705.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5320 bytes_read=9798 bytes_retransmit=18 bytes_invalid=7 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003573  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.30 cputime=342.748 memavail=673904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90706.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5326 bytes_read=9919 bytes_retransmit=18 bytes_invalid=7 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003563  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.30 cputime=342.778 memavail=676332 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90707.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5332 bytes_read=10025 bytes_retransmit=18 bytes_invalid=7 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.36 cputime=342.822 memavail=676332 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90708.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5338 bytes_read=10146 bytes_retransmit=18 bytes_invalid=7 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.36 cputime=342.867 memavail=676332 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90709.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5344 bytes_read=10267 bytes_retransmit=18 bytes_invalid=7 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003550  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.36 cputime=342.911 memavail=676332 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90710.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5350 bytes_read=10373 bytes_retransmit=18 bytes_invalid=7 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.36 cputime=342.956 memavail=676332 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90711.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5356 bytes_read=10507 bytes_retransmit=18 bytes_invalid=7 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.36 cputime=343.001 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90712.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5362 bytes_read=10628 bytes_retransmit=18 bytes_invalid=7 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003547  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=343.046 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90713.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5368 bytes_read=10734 bytes_retransmit=18 bytes_invalid=7 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=343.089 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90714.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5374 bytes_read=10855 bytes_retransmit=18 bytes_invalid=7 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=343.131 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90715.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5380 bytes_read=10976 bytes_retransmit=18 bytes_invalid=7 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.9 pwm=0.000 sysload=0.49 cputime=343.175 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90716.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5386 bytes_read=11095 bytes_retransmit=18 bytes_invalid=7 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.49 cputime=343.219 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90717.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5392 bytes_read=11216 bytes_retransmit=18 bytes_invalid=7 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.53 cputime=343.263 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 90718.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5398 bytes_read=11337 bytes_retransmit=18 bytes_invalid=7 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.53 cputime=343.306 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90719.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5404 bytes_read=11443 bytes_retransmit=18 bytes_invalid=7 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.53 cputime=343.349 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90720.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5410 bytes_read=11564 bytes_retransmit=18 bytes_invalid=7 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.53 cputime=343.394 memavail=675356 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90721.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5416 bytes_read=11698 bytes_retransmit=18 bytes_invalid=7 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.53 cputime=343.436 memavail=674108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90722.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5422 bytes_read=11804 bytes_retransmit=18 bytes_invalid=7 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.57 cputime=343.480 memavail=674108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90723.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5428 bytes_read=11925 bytes_retransmit=18 bytes_invalid=7 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.57 cputime=343.527 memavail=674108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90724.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5434 bytes_read=12039 bytes_retransmit=18 bytes_invalid=7 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.57 cputime=343.575 memavail=674108 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90755.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5626 bytes_read=15698 bytes_retransmit=18 bytes_invalid=7 send_seq=331 receive_seq=331 retransmit_seq=2 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.34 cputime=344.901 memavail=677316 print_time=91.156 buffer_time=0.745 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946505544: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:53:40 2023 (1695171220.9 90757.2)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/klipper
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1946530528: New connection
webhooks client 1946530528: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 90762.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000034 bytes_write=2902 bytes_read=5472 bytes_retransmit=0 bytes_invalid=0 send_seq=205 receive_seq=202 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1779 upcoming_bytes=202 freq=72002702  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.37 cputime=348.861 memavail=676352 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1946530528
webhooks: registering remote method 'reboot_machine' for connection id: 1946530528
webhooks: registering remote method 'pause_job_queue' for connection id: 1946530528
webhooks: registering remote method 'start_job_queue' for connection id: 1946530528
webhooks: registering remote method 'timelapse_newframe' for connection id: 1946530528
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1946530528
webhooks: registering remote method 'timelapse_render' for connection id: 1946530528
Stats 90763.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000034 bytes_write=5097 bytes_read=5748 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003475  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.37 cputime=348.984 memavail=675380 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90764.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000034 bytes_write=5136 bytes_read=5864 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72002943  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.37 cputime=349.032 memavail=675380 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90765.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000034 bytes_write=5142 bytes_read=5970 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003165  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.37 cputime=349.088 memavail=675168 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup/klipper: /home/Klipper/klipper-backup/klipper: Is a directory

Command {update_git_script} finished

Stats 90766.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000019 mcu_task_stddev=0.000034 bytes_write=5148 bytes_read=6106 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003312  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.37 cputime=349.189 memavail=674916 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90767.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5154 bytes_read=6229 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.34 cputime=349.232 memavail=674920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90768.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5160 bytes_read=6335 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003467  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.34 cputime=349.271 memavail=674920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90769.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5166 bytes_read=6471 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003487  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.34 cputime=349.310 memavail=674920 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90770.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5172 bytes_read=6577 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003515  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.34 cputime=349.347 memavail=673912 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90771.5: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000262 mcu_task_stddev=0.000456 bytes_write=5178 bytes_read=6683 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003489  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.34 cputime=349.384 memavail=673024 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90772.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5184 bytes_read=6832 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003480  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.31 cputime=349.426 memavail=672800 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90773.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5190 bytes_read=6938 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003495  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.31 cputime=349.466 memavail=672576 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90774.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5196 bytes_read=7044 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003652  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.31 cputime=349.505 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90775.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5202 bytes_read=7180 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003610  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.31 cputime=349.546 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90776.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5208 bytes_read=7286 bytes_retransmit=0 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003586  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.31 cputime=349.589 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90777.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5214 bytes_read=7405 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=263 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003570  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=349.631 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90778.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5220 bytes_read=7541 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003578  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=349.674 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90779.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5226 bytes_read=7647 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003569  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.29 cputime=349.716 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90780.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5238 bytes_read=7769 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.29 cputime=349.760 memavail=671904 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90781.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5244 bytes_read=7905 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003524  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.29 cputime=349.789 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90782.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5250 bytes_read=8024 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=349.831 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90783.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5256 bytes_read=8130 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=349.876 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90784.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5262 bytes_read=8266 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=349.922 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90785.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5268 bytes_read=8372 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.27 cputime=349.969 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90786.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5274 bytes_read=8478 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.27 cputime=350.011 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90787.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5280 bytes_read=8627 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=350.055 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90788.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5286 bytes_read=8733 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=350.098 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90789.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5292 bytes_read=8854 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=350.144 memavail=671908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90790.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5298 bytes_read=8975 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003577  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=350.187 memavail=670900 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90791.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5304 bytes_read=9081 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003568  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=350.226 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90792.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5310 bytes_read=9215 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=350.270 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90793.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5316 bytes_read=9336 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003556  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.22 cputime=350.314 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90794.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5322 bytes_read=9442 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003583  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=350.357 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90795.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5328 bytes_read=9563 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003613  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=350.400 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90796.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5334 bytes_read=9684 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003599  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.22 cputime=350.439 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90797.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5340 bytes_read=9790 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003590  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.21 cputime=350.478 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90798.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5346 bytes_read=9924 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003578  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.21 cputime=350.521 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90799.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5352 bytes_read=10045 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003572  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.21 cputime=350.563 memavail=670908 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90800.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5358 bytes_read=10151 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003567  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.21 cputime=350.606 memavail=670404 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90801.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5364 bytes_read=10272 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003582  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.21 cputime=350.648 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90802.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5370 bytes_read=10393 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003576  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.19 cputime=350.690 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90803.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5376 bytes_read=10512 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003569  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.19 cputime=350.732 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90804.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5382 bytes_read=10633 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003563  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.19 cputime=350.773 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90805.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5388 bytes_read=10754 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003560  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.19 cputime=350.815 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90806.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5394 bytes_read=10860 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003558  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.19 cputime=350.856 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90807.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5400 bytes_read=10981 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003554  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=350.899 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90808.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5406 bytes_read=11115 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=350.940 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90809.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5412 bytes_read=11221 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.17 cputime=350.979 memavail=670412 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90810.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5418 bytes_read=11342 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.17 cputime=351.020 memavail=670188 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90811.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5424 bytes_read=11463 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.17 cputime=351.060 memavail=670192 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90812.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5430 bytes_read=11569 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.24 cputime=351.102 memavail=670196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90813.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5436 bytes_read=11703 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003536  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=351.143 memavail=670196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 90814.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5442 bytes_read=11824 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003533  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=351.183 memavail=670196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90815.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5448 bytes_read=11930 bytes_retransmit=0 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=0 srtt=0.003 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003529  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=351.226 memavail=670196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90816.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5454 bytes_read=12046 bytes_retransmit=0 bytes_invalid=0 send_seq=303 receive_seq=303 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003530  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.24 cputime=351.271 memavail=670196 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Running Command {update_git_script}...:
/home/Klipper/klipper-backup/klipper: /home/Klipper/klipper-backup/klipper: Is a directory

Command {update_git_script} finished

Stats 90919.6: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=6084 bytes_read=24252 bytes_retransmit=0 bytes_invalid=0 send_seq=408 receive_seq=408 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003532  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.12 cputime=355.521 memavail=675840 print_time=163.007 buffer_time=0.659 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 1946530528: Disconnected
Restarting printer
Start printer at Tue Sep 19 20:56:25 2023 (1695171385.0 90921.4)
===== Config file =====
[force_move]
enable_force_move = True

[virtual_sdcard]
path = /home/Klipper/printer_data/gcodes

[exclude_object]

[pause_resume]

[display_status]

[delayed_gcode DISABLEFILAMENTSENSOR]
initial_duration = 1
gcode = 
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0

[gcode_macro _globals]
variable_filament_sensor_enabled = 0
variable_beeping_enabled = 1
variable_bed_temp_over = 10
variable_pre_purge_prime_length = 1.40
gcode = 
	
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=pre_purge_prime_length VALUE={ variable_pre_purge_prime_length }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=filament_sensor_enabled VALUE={ variable_filament_sensor_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=beeping_enabled VALUE={ variable_beeping_enabled }
	SET_GCODE_VARIABLE MACRO=_globals VARIABLE=bed_temp_over VALUE={ variable_bed_temp_over }

[gcode_macro CONDITIONAL_BEEP]
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% set BEEPING_ENABLED=printer["gcode_macro _globals"].beeping_enabled|default(-1)|int %}
	
	{% if BEEPING_ENABLED == 1 %}
	BEEP I={i} DUR={dur} FREQ={freq}
	{% endif %}

[gcode_macro ADJUST_FILAMENT_SENSOR_STATUS]
gcode = 
	
	{% set NEWSTATUS = params.ENABLE|default(-1)|int %}
	
	{% set FILAMENT_SENSOR_ENABLED=printer["gcode_macro _globals"].filament_sensor_enabled|default(-1)|int %}
	
	{% if FILAMENT_SENSOR_ENABLED == 1 and NEWSTATUS != -1 %}
	SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE={NEWSTATUS}
	{% endif %}

[gcode_macro M109]
rename_existing = M99109
gcode = 
	
	{% set s = params.S|float %}
	
	M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro M190]
rename_existing = M99190
gcode = 
	
	{% set s = params.S|float %}
	
	M140 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}
	{% if s != 0 %}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}
	{% endif %}

[gcode_macro PURGE_LINE]
gcode = 
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	
	{% set extrudeAmount = 26.6 %}
	{% set movementLength = 100.0 %}
	{% set movementSpeed = 15 * 60 %}
	{% set xStart = 0.5 %}
	{% set yStart = 0.5 %}
	
	
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	G92 E0.0
	G90
	G0 X{xStart} Y{yStart} F{maxVelocityAdjusted}
	G1 Z0.4 F500.0
	M83
	G1 E{PRE_PURGE_PRIME_LENGTH} F500
	G1 X{xStart + movementLength} E{extrudeAmount} F{movementSpeed}
	
	G92 E0.0
	M82
	G1 Z5.0

[gcode_macro LOAD_FILAMENT]
gcode = 
	M83
	G1 E30 F300
	G1 E15 F150
	M82

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	M83
	G1 X125 Y50 Z80
	G1 E10 F300
	G1 E-10 F3000
	G1 E-50 F1800
	G1 E-10 F900
	M82

[gcode_macro M600]
gcode = 
	CONDITIONAL_BEEP i=1 dur=300
	CONDITIONAL_BEEP i=1 dur=100
	CONDITIONAL_BEEP i=1 dur=100
	PAUSE

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
gcode = 
	
	{% set z = params.Z|default(10)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE={z}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
	
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	
	SAVE_GCODE_STATE NAME=PAUSE
	BASE_PAUSE
	{% if (printer.gcode_move.position.z + z) < printer.toolhead.axis_maximum.z %}
	G91
	G1 Z{z} F900
	{% else %}
	{ action_respond_info("Pause zhop exceeds maximum Z height.") }
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=zhop VALUE=0
	{% endif %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} F6000
	SAVE_GCODE_STATE NAME=PAUSEPARK
	M104 S0
	SET_IDLE_TIMEOUT TIMEOUT=43200
	{% endif %}
description = Pause the actual running print
variable_restore_idle_timeout = 0

[gcode_macro RESUME]
rename_existing = BASE_RESUME
variable_zhop = 0
variable_etemp = 0
gcode = 
	
	{% set e = params.E|default(2.5)|int %}
	
	{% if printer['pause_resume'].is_paused|int == 1 %}
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=1
	
	SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
	{% if etemp > 0 %}
	M109 S{etemp|int}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSEPARK MOVE=1 MOVE_SPEED=100
	G91
	M83
	{% if printer[printer.toolhead.extruder].temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
	G1 Z{zhop * -1} E{e} F900
	{% else %}
	G1 Z{zhop * -1} F900
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE MOVE=1 MOVE_SPEED=60
	BASE_RESUME
	{% endif %}
description = Resume the actual running print
variable_last_extruder_temp = 0

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro BEEP]
description = BEEP I=3 DUR=200 FREQ=2000: Beep 3 times, for 200ms each, at 2kHz frequency.
gcode = 
	
	{% set i = params.I|default(1)|int %}
	{% set dur = params.DUR|default(100)|int %}
	{% set freq = params.FREQ|default(2000)|int %}
	
	{% for iteration in range(i|int) %}
	SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/freq if freq > 0 else 1 }
	G4 P{dur}
	SET_PIN PIN=beeper VALUE=0
	G4 P{dur}
	{% endfor %}

[gcode_macro PARKFRONT]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKFRONTLOW]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKFRONT
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_minimum.y+5} Z20 F6000
	RESTORE_GCODE_STATE NAME=PARKFRONT

[gcode_macro PARKREAR]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREAR
	G90
	G0 X{printer.toolhead.axis_minimum.x+10} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREAR

[gcode_macro PARKREARCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKREARCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y-10} Z{printer.toolhead.axis_maximum.z-50} F6000
	RESTORE_GCODE_STATE NAME=PARKREARCENTER

[gcode_macro PARKCENTER]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKCENTER
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z{printer.toolhead.axis_maximum.z/2} F6000
	RESTORE_GCODE_STATE NAME=PARKCENTER

[gcode_macro PARKBED]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z15 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro PARKBED_MID]
gcode = 
	HOME_IF_NEEDED
	SAVE_GCODE_STATE NAME=PARKBED
	G90
	G0 X{printer.toolhead.axis_maximum.x/2} Y{printer.toolhead.axis_maximum.y/2} Z50 F6000
	RESTORE_GCODE_STATE NAME=PARKBED

[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode = 
	
	{% set my_current = params.CURRENT|default(0.20)|float %}
	
	{% set oldcurrent = printer.configfile.settings["tmc2209 stepper_z"].run_current %}
	{% set oldhold = printer.configfile.settings["tmc2209 stepper_z"].hold_current %}
	{% set x_max = printer.toolhead.axis_maximum.x %}
	{% set y_max = printer.toolhead.axis_maximum.y %}
	{% set z_max = printer.toolhead.axis_maximum.z %}
	{% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
	{% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	M117 {printer.homed_axes}
	{% if printer.homed_axes != 'xyz' %}
	G28
	{% endif %}
	G90
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 }
	
	G0 Z{z_max -5} F{fast_move_z * 60 }
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={my_current}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={my_current}
	{% endif %}
	
	BEEP I=1
	G4 P200
	
	SET_KINEMATIC_POSITION Z={z_max - 25}
	
	G1 Z{z_max} F{6 * 60}
	BEEP I=2
	G4 P10000
	G1 Z{z_max -6} F{6 * 60}
	BEEP I=3
	G4 P200
	
	SET_TMC_CURRENT STEPPER=stepper_z CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	
	{% if printer.configfile.settings["stepper_z1"] %}
	SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={oldcurrent} HOLDCURRENT={oldhold}
	{% endif %}
	
	G1 Z{z_max -30} F{6 * 60}
	
	G4 P200
	G28 Z

[gcode_macro G34]
gcode = 
	MECHANICAL_GANTRY_CALIBRATION

[menu __main __setup __calib __mech_gantry_calibrate]
type = command
enable = {not printer.idle_timeout.state == "Printing"}
name = G34 Gantry Level
gcode = 
	G34

[gcode_macro PID_TEST_BED]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(70)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z40 F6000
	PID_CALIBRATE HEATER=heater_bed TARGET={TARGETTEMP}

[gcode_macro PID_TEST_HOTEND]
gcode = 
	
	{% set TARGETTEMP = params.TEMP|default(245)|int %}
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	G28
	G90
	G1 X{max_x/2} Y{max_y/2} Z10 F6000
	M106 S64
	PID_CALIBRATE HEATER=extruder TARGET={TARGETTEMP}

[gcode_macro PID_TEST_ALL]
gcode = 
	PID_TEST_BED
	PID_TEST_HOTEND
	SAVE_CONFIG

[gcode_macro DO_PROBE_CALIBRATE]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	PROBE_CALIBRATE

[gcode_macro DO_CREATE_MESH]
gcode = 
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET=60
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET=180
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM=60
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM=180
	G28
	_BED_MESH_CALIBRATE

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro PAUSE'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro PAUSE'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	{action_respond_info("%s, forced by pause_next_layer" % pause_next_layer.call)}
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	{action_respond_info("%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer))}
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.extruder.can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro PRINT_END]
gcode = 
	ADJUST_FILAMENT_SENSOR_STATUS ENABLE=0
	CONDITIONAL_BEEP I=2 DUR=30 FREQ=8500
	{% set PRE_PURGE_PRIME_LENGTH=printer["gcode_macro _globals"].pre_purge_prime_length|default(1.40)|float %}
	
	M400
	G92 E0
	G1 E-{PRE_PURGE_PRIME_LENGTH} F400
	G91
	
	
	{% set zVelocity = printer.configfile.settings.printer.max_z_velocity|default(15)|int %}
	{% set maxVelocity = printer.configfile.settings.printer.max_velocity|default(200)|int %}
	{% set zVelocityAdjusted =  (0.95 * zVelocity * 60)|int  %}
	{% set maxVelocityAdjusted =  (0.95 * maxVelocity * 60)|int  %}
	
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% set lift_height = 25.0 %}
	{% if printer.toolhead.position.z < (max_z - lift_height) %}
	{% set z_safe = lift_height %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	G0 Z{z_safe} F{zVelocityAdjusted}
	G0 X{x_safe} Y{y_safe} F{maxVelocityAdjusted}
	TURN_OFF_HEATERS
	M107
	G90
	G0 X60 Y{max_y} F3600
	SET_SKEW CLEAR=1

[gcode_macro DISABLE_STEPPERS]
description = Disables the printers stepper motors
gcode = 
	M84 X Y E

[gcode_macro Save_Settings]
description = Save Settings
gcode = 
	SAVE_CONFIG

[gcode_macro MESH_CHECK]
description = Checks if a mesh exists to determine whether to create a new one
gcode = 
	{% if printer.bed_mesh.profiles['default'] is defined %}
	BED_MESH_PROFILE LOAD='default'
	{% else %}
	BED_MESH_CALIBRATE
	{% endif %}

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro ADXL_SHAPE_ALL]
description = Test resonances for both axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_X]
description = Test resonances for X axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=x
	RUN_SHELL_COMMAND CMD=adxl_shape_x
	M118 Test done
	SAVE_AND_RESTART

[gcode_macro ADXL_SHAPE_Y]
description = Test resonances for Y axis
gcode = 
	M118 DO NOT TOUCH THE PRINTER UNTIL DONE!!!
	HOME_IF_NEEDED
	SHAPER_CALIBRATE AXIS=y
	RUN_SHELL_COMMAND CMD=adxl_shape_y
	M118 Test done
	SAVE_AND_RESTART

[gcode_shell_command adxl_shape_x]
command = sh ~/printer_data/config/shaper/adxl_shape_x.sh
timeout = 60.
verbose = True

[gcode_shell_command adxl_shape_y]
command = sh ~/printer_data/config/shaper/adxl_shape_y.sh
timeout = 60.
verbose = True

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 10
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[gcode_shell_command backup_cfg]
command = /usr/bin/bash /home/klipper/printer_data/config/autocommit.sh
timeout = 30
verbose = True

[gcode_macro BACKUP_CFG]
description = Backs up config directory GitHub
gcode = 
	RUN_SHELL_COMMAND CMD=backup_cfg

[skew_correction]

[gcode_arcs]
resolution = 0.1

[mcu]
serial = /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
restart_method = command

[printer]
kinematics = cartesian
max_velocity = 275
max_accel = 3500
max_z_velocity = 15
max_z_accel = 45
square_corner_velocity = 8.0

[stepper_x]
step_pin = PC2
dir_pin = !PB9
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.56
endstop_pin = tmc2209_stepper_x:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_x]
uart_pin = PC1
run_current = 0.900
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA5

[stepper_y]
step_pin = PB8
dir_pin = PB7
enable_pin = !PC3
microsteps = 128
rotation_distance = 39.40
endstop_pin = tmc2209_stepper_y:virtual_endstop
position_endstop = 0
position_max = 223
homing_speed = 40
homing_retract_dist = 0

[tmc2209 stepper_y]
uart_pin = PC0
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
driver_sgthrs = 81
diag_pin = PA6

[stepper_z]
step_pin = PB6
dir_pin = !PB5
enable_pin = !PC3
microsteps = 128
rotation_distance = 4
endstop_pin = probe:z_virtual_endstop
position_min = -3
position_max = 258
homing_speed = 5

[tmc2209 stepper_z]
uart_pin = PA15
run_current = 1.000
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3
diag_pin = PA7

[extruder]
step_pin = PB4
dir_pin = !PB3
enable_pin = !PC3
microsteps = 256
rotation_distance = 4.10
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PA1
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC5
min_temp = 0
max_temp = 300
max_extrude_only_distance = 150.0
pressure_advance = 0.0465
max_extrude_cross_section = 5
control = pid
pid_kp = 23.147
pid_ki = 1.559
pid_kd = 85.934

[tmc2209 extruder]
uart_pin = PC14
run_current = 0.550
stealthchop_threshold = 0
interpolate = False
sense_resistor = 0.110
uart_address = 3

[heater_bed]
heater_pin = PA2
sensor_type = EPCOS 100K B57560G104F
sensor_pin = PC4
min_temp = 0
max_temp = 110
control = pid
pid_kp = 68.957
pid_ki = 1.281
pid_kd = 928.332

[probe]
pin = PB1
x_offset = 27
y_offset = -20
samples = 3
samples_result = median
samples_tolerance = 0.01
samples_tolerance_retries = 5
z_offset = 1.660

[safe_z_home]
home_xy_position = 84.50, 135
speed = 100.0
z_hop = 10
z_hop_speed = 15

[bed_mesh]
speed = 175
mesh_min = 27, 5
mesh_max = 222, 203
probe_count = 5,5
algorithm = bicubic
fade_start = 1
fade_end = 10
fade_target = 0

[fan]
pin = PA0

[display]
lcd_type = st7920
cs_pin = PB12
sclk_pin = PB13
sid_pin = PB15
encoder_pins = ^PB14, ^PB10
click_pin = ^!PB2

[input_shaper]
shaper_freq_x = 55.0
shaper_type_x = mzv
shaper_freq_y = 40.6
shaper_type_y = mzv

[bed_screws]
screw1_name = front left
screw1 = 26.5, 31
screw2_name = front right
screw2 = 196.75, 31
screw3_name = back right
screw3 = 196.75, 201
screw4_name = back left
screw4 = 26.5, 201

[screws_tilt_adjust]
screw1_name = center
screw1 = 84.50, 135
screw2_name = front left
screw2 = 0, 51
screw3_name = front right
screw3 = 169.75, 51
screw4_name = back right
screw4 = 169.75, 221
screw5_name = back left
screw5 = 0, 221
speed = 50
horizontal_move_z = 10
screw_thread = CCW-M4

[output_pin beeper]
pin = PC6
value = 0
shutdown_value = 0
pwm = True
cycle_time = 0.0005

[filament_switch_sensor filament_sensor]
switch_pin = !PA4
pause_on_runout = True
insert_gcode = 
	M117 Insert Detected
	{ action_respond_info("Insert Detected") }
runout_gcode = 
	M117 Runout Detected
	{ action_respond_info("Runout Detected") }
	CONDITIONAL_BEEP i=3 dur=300 freq=400

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/Klipper/klipper-backup/script.sh
timeout = 90.0
verbose = True

[gcode_macro PRINT_START]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set HOTEND_TEMP = params.HOTEND_TEMP|default(215)|float %}
	
	BED_MESH_CLEAR
	
	G90
	
	{% if printer.heater_bed.temperature < (BED_TEMP * 0.95) %}
	
	M140 S{BED_TEMP}
	
	G28
	
	G0 X{printer.toolhead.axis_minimum.x + 10} Y{printer.toolhead.axis_minimum.y + 10} Z5 F{250 * 60}
	
	{% endif %}
	
	M190 S{BED_TEMP}
	
	G28
	
	BED_MESH_CALIBRATE
	
	M104 S{HOTEND_TEMP}
	
	SMART_PARK
	
	M109 S{HOTEND_TEMP}
	
	LINE_PURGE
	
	SKEW_PROFILE LOAD=my_skew_profile

[gcode_macro Home_Check]
description = Checks if the printer is homed, if not it homes the printer
gcode = 
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}

[gcode_macro PREHEAT_PETG_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(230)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Hatchbox]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PLA+_Eryone]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(215)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(65)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Polymaker]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(235)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_California_Filament]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(240)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro PREHEAT_PETG_Sunlu]
description = Preheats extruder and bed for PLA printing, extruder set to 150 to prevent filament leaking while homing etc
gcode = 
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(225)|float %}
	{% set BED_TEMP = params.BED_TEMP|default(70)|float %}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={EXTRUDER_TEMP}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={BED_TEMP}

[bed_mesh default]
version = 1
points = 
	0.531719, 0.152031, -0.196406, -0.520469
	0.523125, 0.156875, -0.200625, -0.520313
	0.496562, 0.150937, -0.206250, -0.530469
x_count = 4
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 46.71
max_x = 173.28
min_y = 100.21
max_y = 119.78999999999999

[skew_correction my_skew_profile]
xy_skew = -2.220446049250313e-16
xz_skew = 0.0
yz_skew = 0.0
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 1965508256: New connection
webhooks client 1965508256: Client info {'program': 'Moonraker', 'version': 'v0.8.0-139-g3d9052d'}
Loaded MCU 'mcu' 105 commands (v0.11.0-148-g52f4e20c / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.35.2-2+14+b2) 2.35.2)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Enabling TMC virtual enable for 'stepper_x'
Enabling TMC virtual enable for 'stepper_y'
Enabling TMC virtual enable for 'stepper_z'
Enabling TMC virtual enable for 'extruder'
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (0.0, 25.0)     | (27.0, 5.0)
  1   | (48.8, 25.0)    | (75.8, 5.0)
  2   | (97.5, 25.0)    | (124.5, 5.0)
  3   | (146.2, 25.0)   | (173.2, 5.0)
  4   | (195.0, 25.0)   | (222.0, 5.0)
  5   | (195.0, 74.5)   | (222.0, 54.5)
  6   | (146.2, 74.5)   | (173.2, 54.5)
  7   | (97.5, 74.5)    | (124.5, 54.5)
  8   | (48.8, 74.5)    | (75.8, 54.5)
  9   | (0.0, 74.5)     | (27.0, 54.5)
  10  | (0.0, 124.0)    | (27.0, 104.0)
  11  | (48.8, 124.0)   | (75.8, 104.0)
  12  | (97.5, 124.0)   | (124.5, 104.0)
  13  | (146.2, 124.0)  | (173.2, 104.0)
  14  | (195.0, 124.0)  | (222.0, 104.0)
  15  | (195.0, 173.5)  | (222.0, 153.5)
  16  | (146.2, 173.5)  | (173.2, 153.5)
  17  | (97.5, 173.5)   | (124.5, 153.5)
  18  | (48.8, 173.5)   | (75.8, 153.5)
  19  | (0.0, 173.5)    | (27.0, 153.5)
  20  | (0.0, 223.0)    | (27.0, 203.0)
  21  | (48.8, 223.0)   | (75.8, 203.0)
  22  | (97.5, 223.0)   | (124.5, 203.0)
  23  | (146.2, 223.0)  | (173.2, 203.0)
  24  | (195.0, 223.0)  | (222.0, 203.0)
Starting heater checks for extruder
Write g-code response
Traceback (most recent call last):
  File "/home/Klipper/klipper/klippy/gcode.py", line 446, in _respond_raw
    os.write(self.fd, (msg+"\n").encode())
BlockingIOError: [Errno 11] Resource temporarily unavailable
Stats 90926.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=3046 bytes_read=5472 bytes_retransmit=0 bytes_invalid=0 send_seq=205 receive_seq=202 retransmit_seq=0 srtt=0.004 rttvar=0.002 rto=0.025 ready_bytes=1787 upcoming_bytes=50 freq=72009732  heater_bed: target=0 temp=0.0 pwm=0.000 sysload=0.20 cputime=359.467 memavail=675888 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 1965508256
webhooks: registering remote method 'reboot_machine' for connection id: 1965508256
webhooks: registering remote method 'pause_job_queue' for connection id: 1965508256
webhooks: registering remote method 'start_job_queue' for connection id: 1965508256
webhooks: registering remote method 'timelapse_newframe' for connection id: 1965508256
webhooks: registering remote method 'timelapse_saveFrames' for connection id: 1965508256
webhooks: registering remote method 'timelapse_render' for connection id: 1965508256
Stats 90927.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5099 bytes_read=5733 bytes_retransmit=0 bytes_invalid=0 send_seq=245 receive_seq=244 retransmit_seq=0 srtt=0.005 rttvar=0.001 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=72005405  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.18 cputime=359.579 memavail=675640 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90928.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5121 bytes_read=5849 bytes_retransmit=0 bytes_invalid=0 send_seq=247 receive_seq=247 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003789  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.18 cputime=359.634 memavail=675392 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90929.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5127 bytes_read=5970 bytes_retransmit=0 bytes_invalid=0 send_seq=248 receive_seq=248 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003821  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.18 cputime=359.678 memavail=675392 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90930.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000020 mcu_task_stddev=0.000035 bytes_write=5133 bytes_read=6091 bytes_retransmit=0 bytes_invalid=0 send_seq=249 receive_seq=249 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72004057  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.18 cputime=359.722 memavail=674916 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90931.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5139 bytes_read=6214 bytes_retransmit=0 bytes_invalid=0 send_seq=250 receive_seq=250 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003785  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=359.762 memavail=674708 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Running Command {update_git_script}...:
mkdir: cannot create directory ‘/home/Klipper/klipper-backup//home/Klipper/klipper-backup/klipper’: No such file or directory

cp: -r not specified; omitting directory '/home/Klipper/printer_data'

Reinitialized existing Git repository in /home/Klipper/klipper-backup/.git/

WARNING: git-filter-branch has a glut of gotchas generating mangled history
	 rewrites.  Hit Ctrl-C before proceeding to abort, then use an
	 alternative filtering tool such as 'git filter-repo'
	 (https://github.com/newren/git-filter-repo/) instead.  See the
	 filter-branch manual page for more details; to squelch this warning,
	 set FILTER_BRANCH_SQUELCH_WARNING=1.

Stats 90932.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5145 bytes_read=6335 bytes_retransmit=0 bytes_invalid=0 send_seq=251 receive_seq=251 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003690  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=359.820 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90933.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5151 bytes_read=6456 bytes_retransmit=0 bytes_invalid=0 send_seq=252 receive_seq=252 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003685  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=359.867 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90934.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5157 bytes_read=6562 bytes_retransmit=0 bytes_invalid=0 send_seq=253 receive_seq=253 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003586  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=359.920 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90935.7: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000247 mcu_task_stddev=0.000445 bytes_write=5163 bytes_read=6683 bytes_retransmit=0 bytes_invalid=0 send_seq=254 receive_seq=254 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003571  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.16 cputime=359.973 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90936.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5169 bytes_read=6817 bytes_retransmit=0 bytes_invalid=0 send_seq=255 receive_seq=255 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003564  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.16 cputime=360.024 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90937.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5175 bytes_read=6923 bytes_retransmit=0 bytes_invalid=0 send_seq=256 receive_seq=256 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=360.077 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90938.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5181 bytes_read=7044 bytes_retransmit=0 bytes_invalid=0 send_seq=257 receive_seq=257 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003715  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=360.126 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90939.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5187 bytes_read=7165 bytes_retransmit=0 bytes_invalid=0 send_seq=258 receive_seq=258 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003661  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=360.172 memavail=673988 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90940.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5193 bytes_read=7271 bytes_retransmit=0 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003625  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=360.218 memavail=673488 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90941.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5199 bytes_read=7405 bytes_retransmit=0 bytes_invalid=0 send_seq=260 receive_seq=260 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003617  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.15 cputime=360.265 memavail=673504 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Proceeding with filter-branch...


Rewrite 2ab6713396ac128050d658f45ee7c69ad8408884 (1/4) (0 seconds passed, remaining 0 predicted)    fatal: /.env: '/.env' is outside repository at '/home/Klipper/klipper-backup/.git-rewrite/t'

index filter failed: git rm -r --cached --ignore-unmatch "$parent_path"/.env

On branch main
nothing to commit, working tree clean

Stats 90942.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5205 bytes_read=7526 bytes_retransmit=0 bytes_invalid=0 send_seq=261 receive_seq=261 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003610  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=360.318 memavail=669000 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Everything up-to-date

Command {update_git_script} finished

Stats 90943.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5217 bytes_read=7632 bytes_retransmit=0 bytes_invalid=0 send_seq=263 receive_seq=262 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003587  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.22 cputime=360.396 memavail=676256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90944.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5223 bytes_read=7784 bytes_retransmit=0 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003571  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.22 cputime=360.436 memavail=676256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90945.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5229 bytes_read=7890 bytes_retransmit=0 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003557  heater_bed: target=0 temp=23.5 pwm=0.000 sysload=0.22 cputime=360.473 memavail=676256 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90946.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5235 bytes_read=8009 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003537  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.22 cputime=360.510 memavail=672128 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90947.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5241 bytes_read=8145 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003531  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.20 cputime=360.544 memavail=675756 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90948.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5247 bytes_read=8251 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.20 cputime=360.587 memavail=674860 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90949.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5253 bytes_read=8357 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003520  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.20 cputime=360.630 memavail=673740 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90950.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5259 bytes_read=8493 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003523  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.20 cputime=360.670 memavail=672596 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90951.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5265 bytes_read=8612 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003525  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.20 cputime=360.710 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90952.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5271 bytes_read=8718 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003522  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.18 cputime=360.754 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90953.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5277 bytes_read=8854 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003547  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.18 cputime=360.799 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90954.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5283 bytes_read=8960 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003551  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.18 cputime=360.843 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90955.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5289 bytes_read=9066 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.18 cputime=360.887 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90956.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5295 bytes_read=9215 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.18 cputime=360.932 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90957.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5301 bytes_read=9321 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.17 cputime=360.975 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90958.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5307 bytes_read=9427 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.17 cputime=361.020 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90959.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5313 bytes_read=9563 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.17 cputime=361.063 memavail=672600 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90960.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5319 bytes_read=9669 bytes_retransmit=0 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.17 cputime=361.103 memavail=676136 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90961.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5325 bytes_read=9788 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003546  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.17 cputime=361.144 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90962.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5331 bytes_read=9924 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=361.190 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90963.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5337 bytes_read=10030 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003545  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=361.232 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90964.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5343 bytes_read=10136 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003548  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=361.274 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90965.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5349 bytes_read=10272 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=361.320 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90966.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5355 bytes_read=10378 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.16 cputime=361.365 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90967.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5361 bytes_read=10497 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003544  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.14 cputime=361.410 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90968.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5367 bytes_read=10633 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.14 cputime=361.454 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90969.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5373 bytes_read=10739 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.14 cputime=361.497 memavail=676148 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90970.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5379 bytes_read=10845 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.14 cputime=361.542 memavail=675140 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90971.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000007 bytes_write=5385 bytes_read=10981 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003543  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.14 cputime=361.585 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90972.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5391 bytes_read=11100 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.13 cputime=361.628 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90973.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5397 bytes_read=11206 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.13 cputime=361.668 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90974.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5403 bytes_read=11342 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003539  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.13 cputime=361.710 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90975.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5409 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.13 cputime=361.752 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90976.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5415 bytes_read=11554 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003540  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.13 cputime=361.794 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90977.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5421 bytes_read=11703 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.004 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003542  heater_bed: target=0 temp=23.8 pwm=0.000 sysload=0.12 cputime=361.837 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90978.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5427 bytes_read=11809 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003541  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.12 cputime=361.879 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 90979.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5433 bytes_read=11915 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.6 pwm=0.000 sysload=0.12 cputime=361.921 memavail=675152 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 90980.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000007 bytes_write=5439 bytes_read=12044 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.004 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72003538  heater_bed: target=0 temp=23.7 pwm=0.000 sysload=0.12 cputime=361.963 memavail=674144 print_time=0.011 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
